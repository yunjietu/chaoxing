import{c as e,P as a,s as t,S as l}from"./index-SeYMZHv7.js";import{a as i}from"./account-api-CPPoY5oD.js";import o from"./account-operate-modal-D8M230BS.js";import s from"./internship-detail-modal-BvPlv1gL.js";import{d as n}from"./default-time-ranges-C0dlfVG_.js";import{_ as r}from"./index-C3kHkCVg.js";import{T as d}from"./table-id-const-CfofKxZg.js";import{M as u,b as c}from"./ant-design-vue-qdrtx42b.js";import{r as p,a as m,e as f,b2 as g,z as y,b as h,o as v,y as w,c as _,ag as x,bz as b,u as j,K as k,J as S,ai as I,ah as z,be as C,F as T,h as q}from"./@vue-wTDZSr7R.js";import"./@ant-design-BpN5YQ3K.js";import"./vue-LkNShnlx.js";import"./@ctrl-BZ4iwDfm.js";import"./lodash-DG05lPuJ.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-Dk7pxPyP.js";import"./vue-i18n-DZLdcVEL.js";import"./@intlify-D9VlDxbJ.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-DUpU9tZe.js";import"./sm-crypto-CNoQwlJF.js";import"./jsbn-aJNYh3Pg.js";import"./nprogress-Buvl-64T.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-BUNCmyKw.js";import"./stylis-cmx5w8r8.js";import"./vue-types-Ci_fOQyt.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./sortablejs-CRp0PNdb.js";/* empty css                                                                                 */const U={class:"smart-table-operate-block"},E={class:"btn-row-gap"},O={class:"smart-table-setting-block"},N={key:1},D={key:4,class:"smart-table-operate"},P={class:"smart-query-table-page"},A={__name:"account-list",setup(A){const R=p([{title:"ID",dataIndex:"id",align:"center",width:55},{title:"用户ID",dataIndex:"userId",align:"center",width:125,ellipsis:!0},{title:"姓名",dataIndex:"name",align:"center",width:75,ellipsis:!0},{title:"账号",dataIndex:"account",align:"center",width:120,ellipsis:!0},{title:"密码",dataIndex:"password",align:"center",width:120,ellipsis:!0},{title:"学校",dataIndex:"school",align:"center",width:160,ellipsis:!0},{title:"专业",dataIndex:"major",align:"center",width:120,ellipsis:!0},{title:"签约企业",dataIndex:"contractEnterprise",align:"center",width:150,ellipsis:!0},{title:"实习状态",dataIndex:"internshipStatus",align:"center",width:80},{title:"状态",dataIndex:"disabledFlag",align:"center",width:80},{title:"登录状态",dataIndex:"loginStatus",key:"loginStatus",align:"center",width:80},{title:"详细信息",dataIndex:"queryInfo",align:"center",width:90},{title:"创建人",width:60,dataIndex:"createUserName"},{title:"创建时间",dataIndex:"createTime",width:135},{title:"操作",dataIndex:"action",width:80}]),M={keywords:"",endTime:null,startTime:null,pageNum:1,pageSize:e,searchCount:!0,loginStatus:"",internshipStatus:""},F=m({...M}),V=p(!1),Q=p([]),B=p(0);let J=p();function K(e,a){F.startTime=a[0],F.endTime=a[1]}function $(){F.pageNum=1,X()}function H(){J.value=[],Object.assign(F,M),X()}async function X(){try{V.value=!0;let e=await i.pageQuery(F);const a=e.data.list;B.value=e.data.total,Q.value=a}catch(e){t.captureError(e)}finally{V.value=!1}}function Y(e){u.confirm({title:"确定要删除吗？",content:"删除后，该信息将不可恢复",okText:"删除",okType:"danger",onOk(){!async function(e){try{l.show(),await i.delete(e),c.success("删除成功"),X()}catch(a){t.captureError(a)}finally{l.hide()}}(e)},cancelText:"取消",onCancel(){}})}const Z=p();const G=async()=>{const e=await i.queryDuplicateAccount();e.ok&&u.info({title:"重复账号",content:e.data.length?q("div",[q("div",{style:"text-align:center;margin-bottom:10px;"},["共计 ",q("b",e.data.length)," 个重复账号"]),q("div",{style:"max-height:300px;overflow:auto;word-break:break-all;margin-top:8px;"},e.data.join(", "))]):"无重复账号",okText:"知道了",centered:!0})},L=async()=>{u.confirm({title:"确认删除所有重复账号吗？",onOk:async()=>{(await i.deleteDuplicateAccount()).ok&&(c.success("删除成功"),X())}})},W=p();return f(X),(e,u)=>{const p=g("a-input"),m=g("a-form-item"),f=g("a-col"),q=g("a-range-picker"),A=g("a-select-option"),M=g("a-select"),ee=g("SearchOutlined"),ae=g("a-button"),te=g("ReloadOutlined"),le=g("a-space"),ie=g("a-row"),oe=g("a-form"),se=g("PlusOutlined"),ne=g("FileExcelOutlined"),re=g("a-tag"),de=g("a-table"),ue=g("a-pagination"),ce=g("a-card"),pe=y("privilege");return v(),h(T,null,[w((v(),x(oe,{class:"smart-query-form"},{default:b((()=>[_(ie,{class:"smart-query-form-row",gutter:"8"},{default:b((()=>[_(f,{xs:24,sm:12,md:5},{default:b((()=>[_(m,{label:"关键字",class:"smart-query-form-item"},{default:b((()=>[_(p,{style:{width:"250px"},value:F.keywords,"onUpdate:value":u[0]||(u[0]=e=>F.keywords=e),placeholder:"姓名/账号/学校/专业/签约企业","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),_(f,{xs:24,sm:12,md:6},{default:b((()=>[_(m,{label:"创建时间",class:"smart-query-form-item"},{default:b((()=>[_(q,{value:j(J),"onUpdate:value":u[1]||(u[1]=e=>k(J)?J.value=e:J=e),presets:j(n),onChange:K,style:{width:"250px"}},null,8,["value","presets"])])),_:1})])),_:1}),_(f,{xs:12,sm:6,md:4},{default:b((()=>[_(m,{label:"实习状态",class:"smart-query-form-item"},{default:b((()=>[_(M,{value:F.internshipStatus,"onUpdate:value":u[2]||(u[2]=e=>F.internshipStatus=e),style:{width:"100%"},"allow-clear":"",placeholder:"全部"},{default:b((()=>[_(A,{value:""},{default:b((()=>[S("全部")])),_:1}),_(A,{value:"1"},{default:b((()=>[S("正在实习")])),_:1}),_(A,{value:"2"},{default:b((()=>[S("实习结束")])),_:1}),_(A,{value:"3"},{default:b((()=>[S("签约成功")])),_:1}),_(A,{value:"4"},{default:b((()=>[S("未开始")])),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),_(f,{xs:12,sm:6,md:4},{default:b((()=>[_(m,{label:"登录状态",class:"smart-query-form-item"},{default:b((()=>[_(M,{value:F.loginStatus,"onUpdate:value":u[3]||(u[3]=e=>F.loginStatus=e),style:{width:"100%"},"allow-clear":"",placeholder:"全部"},{default:b((()=>[_(A,{value:""},{default:b((()=>[S("全部")])),_:1}),_(A,{value:"未登录"},{default:b((()=>[S("未登录")])),_:1}),_(A,{value:"成功"},{default:b((()=>[S("成功")])),_:1}),_(A,{value:"失败"},{default:b((()=>[S("失败")])),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),_(f,{xs:24,sm:24,md:5},{default:b((()=>[_(m,{class:"smart-query-form-item"},{default:b((()=>[_(le,null,{default:b((()=>[_(ae,{type:"primary",onClick:$},{icon:b((()=>[_(ee)])),default:b((()=>[S(" 查询 ")])),_:1}),_(ae,{onClick:H},{icon:b((()=>[_(te)])),default:b((()=>[S(" 重置 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})),[[pe,"oa:account:query"]]),_(ce,{size:"small",bordered:!1,hoverable:!0},{default:b((()=>[_(ie,{class:"smart-table-btn-block"},{default:b((()=>[I("div",U,[I("div",null,[w((v(),x(ae,{onClick:u[4]||(u[4]=e=>{Z.value.showModal()}),type:"primary"},{icon:b((()=>[_(se)])),default:b((()=>[S(" 添加账号 ")])),_:1})),[[pe,"oa:account:add"]]),w((v(),x(ae,{onClick:u[5]||(u[5]=e=>async function(){await i.exportExcel(F)}()),type:"primary"},{icon:b((()=>[_(ne)])),default:b((()=>[S(" 导出账号（带水印） ")])),_:1})),[[pe,"oa:account:exportExcel"]])]),I("div",E,[w((v(),x(ae,{onClick:G,type:"default",style:{"margin-left":"8px"}},{default:b((()=>[S(" 查询重复账号 ")])),_:1})),[[pe,"oa:account:queryDuplicate"]]),w((v(),x(ae,{onClick:L,type:"primary",danger:"",style:{"margin-left":"8px"}},{default:b((()=>[S(" 删除重复账号 ")])),_:1})),[[pe,"oa:account:deleteDuplicate"]])])]),I("div",O,[_(r,{modelValue:R.value,"onUpdate:modelValue":u[6]||(u[6]=e=>R.value=e),tableId:j(d).BUSINESS.OA.ACCOUNT,refresh:X},null,8,["modelValue","tableId"])])])),_:1}),_(de,{scroll:{x:1300},size:"small",dataSource:Q.value,columns:R.value,rowKey:"id",pagination:!1,loading:V.value,bordered:""},{bodyCell:b((({column:a,record:o,text:s})=>["disabledFlag"===a.dataIndex?(v(),x(re,{key:0,color:s?"red":"green"},{default:b((()=>[S(C(s?"禁用":"启用"),1)])),_:2},1032,["color"])):"internshipStatus"===a.dataIndex?(v(),h("span",N,C(e.$smartEnumPlugin.getDescByValue("INTERNSHIP_STATUS_ENUM",s)),1)):"loginStatus"===a.dataIndex?(v(),x(re,{key:2,color:"成功"===s?"green":"失败"===s?"red":"default"},{default:b((()=>[S(C(s||"未登录"),1)])),_:2},1032,["color"])):"queryInfo"===a.dataIndex?(v(),x(ae,{key:3,type:"primary",size:"small",onClick:e=>async function(e){if(e.loginStatus&&"成功"===e.loginStatus)try{e.loading=!0,l.show();const a=await i.getZhixiaoUserInfo({account:e.account,password:e.password});if(!a.data||!a.data.token||!a.data.deviceId)return c.error("登录失败，请稍后再试"),l.hide(),void(e.loading=!1);const t=a.data.token,o=a.data.deviceId,s=a.data.uid,n=await i.getInternshipInfo({uid:s,token:t,deviceId:o});n.data&&n.data.bmid?W.value.showModal({uid:s,token:t,deviceId:o,bmid:n.data.bmid}):c.warning("未获取到实习信息，无法查询详情")}catch(a){t.captureError(a),c.error("获取实习信息失败")}finally{e.loading=!1,l.hide()}else c.warning("请先登录账号获取信息")}(o),disabled:!o.loginStatus||"成功"!==o.loginStatus,loading:o.loading},{default:b((()=>[S(" 查询信息 ")])),_:2},1032,["onClick","disabled","loading"])):z("",!0),"action"===a.dataIndex?(v(),h("div",D,[w((v(),x(ae,{onClick:e=>{return a=o.id,void Z.value.showModal(a);var a},size:"small",type:"link"},{default:b((()=>[S("编辑")])),_:2},1032,["onClick"])),[[pe,"oa:account:update"]]),w((v(),x(ae,{onClick:e=>Y(o.id),size:"small",danger:"",type:"link"},{default:b((()=>[S("删除")])),_:2},1032,["onClick"])),[[pe,"oa:account:delete"]])])):z("",!0)])),_:1},8,["dataSource","columns","loading"]),I("div",P,[_(ue,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:j(a),defaultPageSize:F.pageSize,current:F.pageNum,"onUpdate:current":u[7]||(u[7]=e=>F.pageNum=e),pageSize:F.pageSize,"onUpdate:pageSize":u[8]||(u[8]=e=>F.pageSize=e),total:B.value,onChange:X,onShowSizeChange:X,"show-total":e=>`共${e}条`},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])]),_(o,{ref_key:"operateRef",ref:Z,onRefresh:X},null,512),_(s,{ref_key:"internshipDetailRef",ref:W},null,512)])),_:1})],64)}}};export{A as default};
