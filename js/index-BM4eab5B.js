import{_ as e}from"./lodash-DG05lPuJ.js";import{_ as a,y as t,c as l,d as o,P as n,e as i,s,S as r}from"./index-SeYMZHv7.js";import d from"./index-C_rXpfyf.js";import p from"./index-BJ6ghzTh.js";import u from"./index-CNIIhBUX.js";import{_ as c}from"./index-C3kHkCVg.js";import{T as m}from"./table-id-const-CfofKxZg.js";import{b as y,M as v}from"./ant-design-vue-qdrtx42b.js";import{E as f}from"./@ant-design-BpN5YQ3K.js";import{r as g,a as h,w as b,m as j,b2 as w,z as I,ag as x,o as k,bz as _,ai as N,c as C,J as z,y as E,u as S,b as F,ah as O,F as T,be as M,h as U}from"./@vue-wTDZSr7R.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-Dk7pxPyP.js";import"./vue-i18n-DZLdcVEL.js";import"./@intlify-D9VlDxbJ.js";import"./vue-LkNShnlx.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-DUpU9tZe.js";import"./sm-crypto-CNoQwlJF.js";import"./jsbn-aJNYh3Pg.js";import"./nprogress-Buvl-64T.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./@ctrl-BZ4iwDfm.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-BUNCmyKw.js";import"./stylis-cmx5w8r8.js";import"./vue-types-Ci_fOQyt.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./role-api-BdA7V71d.js";import"./index-D6sqxCCk.js";import"./department-api-IZzKtGZG.js";import"./index-DPBcXeae.js";import"./index-BLMPELrm.js";import"./position-api-Cwzz9KIn.js";import"./regular-const-Uc_6Drqv.js";import"./index-D_ltEPWZ.js";import"./department-mitt-B-AWyKXu.js";import"./clipboard-C5bz8zay.js";import"./sortablejs-CRp0PNdb.js";/* empty css                                                                                 */const D={class:"header"},P={class:"query-operate"},L={class:"btn-group"},B={class:"smart-table-column-operate"},R={key:2},q={key:3,class:"smart-table-operate"},V={class:"smart-query-table-page"},$=a({__name:"index",props:{departmentId:Number,breadcrumb:Array},setup(a){const $=t().administratorFlag,A=a;let J=g();function Y(e,a){J.value.showModal(e,a)}const Q=g([{title:"姓名",dataIndex:"actualName",width:85},{title:"性别",dataIndex:"gender",width:70},{title:"登录账号",dataIndex:"loginName",width:100},{title:"手机号",dataIndex:"phone",width:85},{title:"邮箱",dataIndex:"email",width:100,ellipsis:!0},{title:"超管",dataIndex:"administratorFlag",width:60},{title:"状态",dataIndex:"disabledFlag",width:60},{title:"职务",dataIndex:"positionName",width:100,ellipsis:!0},{title:"角色",dataIndex:"roleNameList",width:100},{title:"部门",dataIndex:"departmentName",ellipsis:!0,width:200},{title:"余额",dataIndex:"balance",width:120,customRender:({record:e})=>U("span",[U("span",void 0!==e.balance?e.balance:"--"),U("a",{style:"margin-left: 8px; color: #1890ff; cursor: pointer;",onClick:()=>function(e){i.getBalanceLogs(e.employeeId).then((a=>{const t=a.data||[];v.info({title:`余额明细 - ${e.actualName}`,width:600,content:U("div",{style:"text-align: center;"},[U("div",{style:"margin-bottom: 12px;"},`当前余额：￥${e.balance}`),U("table",{class:"ant-table",style:"width:100%;margin-top:12px;"},[U("thead",{},[U("tr",{},[U("th",{},"时间"),U("th",{},"类型"),U("th",{},"变动金额"),U("th",{},"变动后余额"),U("th",{},"备注")])]),U("tbody",{},t.map((e=>U("tr",{},[U("td",{},e.createTime),U("td",{},1===e.type?"充值":"消费"),U("td",{},e.amount),U("td",{},e.afterBalance),U("td",{},e.remark||"")]))))])])})}))}(e)},"明细"),$&&U("a",{style:"margin-left: 8px; color: #52c41a; cursor: pointer;",onClick:()=>function(e){ve=e.employeeId,ce.value="",ue.value=!0}(e)},"充值")])},{title:"操作",dataIndex:"operate",width:140}]),G=g();let K={departmentId:void 0,disabledFlag:!1,keyword:void 0,searchCount:void 0,pageNum:1,pageSize:l,sortItemList:void 0};const W=h({...K}),X=g(0);function H(){Object.assign(W,K),ee()}const Z=g(!1);async function ee(){Z.value=!0;try{W.departmentId=A.departmentId;let a=await i.queryEmployee(W);for(const l of a.data.list)l.roleNameList=e.join(l.roleNameList,",");const t={};await Promise.all(a.data.list.map((async e=>{try{const a=await i.getBalance(e.employeeId);t[e.employeeId]=a.data?.balance??"--"}catch{t[e.employeeId]="--"}}))),a.data.list.forEach((e=>{e.balance=t[e.employeeId]})),G.value=a.data.list,X.value=a.data.total,te.value=[],le.value=[]}catch(a){s.captureError(a)}finally{Z.value=!1}}async function ae(a){Z.value=!0;try{W.pageNum=1,W.departmentId=a?void 0:A.departmentId;let t=await i.queryEmployee(W);for(const a of t.data.list)a.roleNameList=e.join(a.roleNameList,",");const l={};await Promise.all(t.data.list.map((async e=>{try{const a=await i.getBalance(e.employeeId);l[e.employeeId]=a.data?.balance??"--"}catch{l[e.employeeId]="--"}}))),t.data.list.forEach((e=>{e.balance=l[e.employeeId]})),G.value=t.data.list,X.value=t.data.total,te.value=[],le.value=[]}catch(t){s.captureError(t)}finally{Z.value=!1}}b((()=>A.departmentId),(()=>{A.departmentId!==W.departmentId&&(W.pageNum=1,ee())}),{immediate:!0});let te=g([]),le=g([]);const oe=j((()=>te.value.length>0));function ne(e,a){te.value=e,le.value=a}function ie(){if(!oe.value)return void y.warning("请选择要删除的员工");const a=le.value.map((e=>e.actualName)),t=le.value.map((e=>e.employeeId));v.confirm({title:"确定要删除如下员工吗?",icon:C(f),content:e.join(a,","),okText:"删除",okType:"danger",async onOk(){r.show();try{await i.batchDeleteEmployee(t),y.success("删除成功"),ee(),te.value=[],le.value=[]}catch(e){s.captureError(e)}finally{r.hide()}},cancelText:"取消",onCancel(){}})}const se=g();function re(){if(!oe.value)return void y.warning("请选择要调整部门的员工");const e=le.value.map((e=>e.employeeId));se.value.showModal(e)}const de=g();function pe(a){let t={};a?(t=e.cloneDeep(a),t.disabledFlag=t.disabledFlag?1:0):A.departmentId&&(t.departmentId=A.departmentId),de.value.showDrawer(t)}const ue=g(!1),ce=g(""),me=g(!1),ye=g("");let ve=null;async function fe(){!ce.value||isNaN(ce.value)||Number(ce.value)<=0?y.error("请输入有效金额"):(await i.recharge(ve,ce.value,"管理员充值"),y.success("充值成功"),ue.value=!1,ee())}async function ge(){!ye.value||isNaN(ye.value)||Number(ye.value)<=0?y.error("请输入有效金额"):(await i.consume(ve,ye.value,"管理员消费"),y.success("消费成功"),me.value=!1,ee())}return(e,a)=>{const t=w("a-typography-title"),l=w("a-radio-button"),g=w("a-radio-group"),h=w("SearchOutlined"),b=w("a-button"),j=w("a-input-search"),U=w("ReloadOutlined"),$=w("a-tag"),A=w("a-table"),K=w("a-pagination"),le=w("a-input"),oe=w("a-modal"),ve=w("a-card"),he=I("privilege");return k(),x(ve,{class:"employee-container"},{default:_((()=>[N("div",D,[C(t,{level:5},{default:_((()=>[z("部门人员")])),_:1}),N("div",P,[C(g,{value:W.disabledFlag,"onUpdate:value":a[0]||(a[0]=e=>W.disabledFlag=e),style:{margin:"8px","flex-shrink":"0"},onChange:a[1]||(a[1]=e=>ae(!1))},{default:_((()=>[C(l,{value:void 0},{default:_((()=>[z("全部")])),_:1}),C(l,{value:!1},{default:_((()=>[z("启用")])),_:1}),C(l,{value:!0},{default:_((()=>[z("禁用")])),_:1})])),_:1},8,["value"]),C(j,{value:W.keyword,"onUpdate:value":a[2]||(a[2]=e=>W.keyword=e),valueModifiers:{trim:!0},placeholder:"姓名/手机号/登录账号",onSearch:a[3]||(a[3]=e=>ae(!0))},{enterButton:_((()=>[C(b,{type:"primary"},{icon:_((()=>[C(h)])),default:_((()=>[z(" 查询 ")])),_:1})])),_:1},8,["value"]),C(b,{onClick:H,class:"smart-margin-left10"},{icon:_((()=>[C(U)])),default:_((()=>[z(" 重置 ")])),_:1})])]),N("div",L,[E((k(),x(b,{class:"btn",type:"primary",onClick:pe},{default:_((()=>[z("添加成员")])),_:1})),[[he,"system:employee:add"]]),E((k(),x(b,{class:"btn",onClick:re},{default:_((()=>[z("调整部门")])),_:1})),[[he,"system:employee:department:update"]]),E((k(),x(b,{class:"btn",onClick:ie},{default:_((()=>[z("批量删除")])),_:1})),[[he,"system:employee:delete"]]),N("span",B,[C(c,{modelValue:Q.value,"onUpdate:modelValue":a[4]||(a[4]=e=>Q.value=e),tableId:S(m).SYSTEM.EMPLOYEE,refresh:ee},null,8,["modelValue","tableId"])])]),C(A,{"row-selection":{selectedRowKeys:S(te),onChange:ne},size:"small",columns:Q.value,"data-source":G.value,pagination:!1,loading:Z.value,scroll:{x:1500},"row-key":"employeeId",bordered:""},{bodyCell:_((({text:a,record:t,index:l,column:o})=>["administratorFlag"===o.dataIndex?(k(),F(T,{key:0},[a?(k(),x($,{key:0,color:"error"},{default:_((()=>[z("超管")])),_:1})):O("",!0)],64)):O("",!0),"disabledFlag"===o.dataIndex?(k(),x($,{key:1,color:a?"error":"processing"},{default:_((()=>[z(M(a?"禁用":"启用"),1)])),_:2},1032,["color"])):"gender"===o.dataIndex?(k(),F("span",R,M(e.$smartEnumPlugin.getDescByValue("GENDER_ENUM",a)),1)):"operate"===o.dataIndex?(k(),F("div",q,[E((k(),x(b,{type:"link",size:"small",onClick:e=>pe(t)},{default:_((()=>[z("编辑")])),_:2},1032,["onClick"])),[[he,"system:employee:update"]]),E((k(),x(b,{type:"link",size:"small",onClick:e=>{return a=t.employeeId,l=t.loginName,void v.confirm({title:"提醒",icon:C(f),content:"确定要重置密码吗?",okText:"确定",okType:"danger",async onOk(){r.show();try{let{data:e}=await i.resetPassword(a);y.success("重置成功"),J.value.showModal(l,e),ee()}catch(e){s.captureError(e)}finally{r.hide()}},cancelText:"取消",onCancel(){}});var a,l}},{default:_((()=>[z("重置密码")])),_:2},1032,["onClick"])),[[he,"system:employee:password:reset"]]),E((k(),x(b,{type:"link",onClick:e=>{return a=t.employeeId,l=t.disabledFlag,void v.confirm({title:"提醒",icon:C(f),content:`确定要${l?"启用":"禁用"}吗?`,okText:"确定",okType:"danger",async onOk(){r.show();try{await i.updateDisabled(a),y.success((l?"启用":"禁用")+"成功"),ee()}catch(e){s.captureError(e)}finally{r.hide()}},cancelText:"取消",onCancel(){}});var a,l}},{default:_((()=>[z(M(t.disabledFlag?"启用":"禁用"),1)])),_:2},1032,["onClick"])),[[he,"system:employee:disabled"]])])):O("",!0)])),_:1},8,["row-selection","columns","data-source","loading"]),N("div",V,[C(K,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:S(n),defaultPageSize:W.pageSize,current:W.pageNum,"onUpdate:current":a[5]||(a[5]=e=>W.pageNum=e),pageSize:W.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>W.pageSize=e),total:X.value,onChange:ee,onShowSizeChange:ee,"show-total":S(o)},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])]),C(d,{ref_key:"employeeFormModal",ref:de,onRefresh:ee,onShowAccount:Y},null,512),C(p,{ref_key:"employeeDepartmentFormModal",ref:se,onRefresh:ee},null,512),C(u,{ref_key:"employeePasswordDialog",ref:J},null,512),C(oe,{open:ue.value,"onUpdate:open":a[8]||(a[8]=e=>ue.value=e),title:"充值",onOk:fe,onCancel:a[9]||(a[9]=()=>{ue.value=!1})},{default:_((()=>[C(le,{value:ce.value,"onUpdate:value":a[7]||(a[7]=e=>ce.value=e),placeholder:"请输入充值金额",type:"number"},null,8,["value"])])),_:1},8,["open"]),C(oe,{open:me.value,"onUpdate:open":a[11]||(a[11]=e=>me.value=e),title:"消费",onOk:ge,onCancel:a[12]||(a[12]=()=>{me.value=!1})},{default:_((()=>[C(le,{value:ye.value,"onUpdate:value":a[10]||(a[10]=e=>ye.value=e),placeholder:"请输入消费金额",type:"number"},null,8,["value"])])),_:1},8,["open"])])),_:1})}}},[["__scopeId","data-v-a6d92961"]]);export{$ as default};
