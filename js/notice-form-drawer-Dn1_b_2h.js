import{r as e,a as l,b2 as a,b as t,o as i,c as o,bz as s,y as n,F as u,b0 as r,ag as d,J as c,be as m,ai as p,E as v,u as f,n as b}from"./@vue-wTDZSr7R.js";import{_ as h}from"./lodash-DG05lPuJ.js";import{d as y}from"./dayjs-Dk7pxPyP.js";import{_ as g,U as j,F as _,s as T,S as w}from"./index-SeYMZHv7.js";import{n as F}from"./notice-api-CJupa0Sd.js";import{W as I}from"./index-CtS3x09i.js";import k from"./notice-form-visible-modal-DnXkdJ15.js";import{M as x,b as C}from"./ant-design-vue-qdrtx42b.js";import"./@ant-design-BpN5YQ3K.js";import"./vue-LkNShnlx.js";import"./@ctrl-BZ4iwDfm.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./vue-i18n-DZLdcVEL.js";import"./@intlify-D9VlDxbJ.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-DUpU9tZe.js";import"./sm-crypto-CNoQwlJF.js";import"./jsbn-aJNYh3Pg.js";import"./nprogress-Buvl-64T.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-BUNCmyKw.js";import"./stylis-cmx5w8r8.js";import"./vue-types-Ci_fOQyt.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./@wangeditor-next-BWE1cd2r.js";import"./notice-form-visible-transfer-department-CkBBxJvP.js";import"./department-api-IZzKtGZG.js";import"./notice-form-visible-transfer-employee-OCOPrTju.js";const V={class:"visible-list"},L="YYYY-MM-DD HH:mm:ss",U=g({__name:"notice-form-drawer",emits:["reloadList"],setup(g,{expose:U,emit:N}){const E=N,H=e(!1);function R(){H.value=!1}const M=e(),q=e(),O=e(),S={noticeId:void 0,noticeTypeId:void 0,title:void 0,categoryId:void 0,source:void 0,documentNumber:void 0,author:void 0,allVisibleFlag:1,visibleRangeList:[],scheduledPublishFlag:!1,publishTime:void 0,attachment:[],contentHtml:"",contentText:""},z=l({...S}),P={title:[{required:!0,message:"请输入"}],noticeTypeId:[{required:!0,message:"请选择分类"}],allVisibleFlag:[{required:!0,message:"请选择"}],source:[{required:!0,message:"请输入来源"}],author:[{required:!0,message:"请输入作者"}],contentHtml:[{required:!0,message:"请输入内容"}]};async function Y(){try{z.contentHtml=q.value.getHtml(),z.contentText=q.value.getText(),await M.value.validateFields(),async function(){try{w.show(),z.allVisibleFlag&&(z.visibleRangeList=[]),z.publishTime||(z.publishTime=y().format(L)),z.noticeId?await F.updateNotice(z):await F.addNotice(z),C.success("保存成功"),E("reloadList"),R()}catch(e){T.captureError(e)}finally{w.hide()}}()}catch(e){C.error("参数验证错误，请仔细填写表单数据!")}}const D=e([]);function A(){const e=z.visibleRangeList||[];O.value.showModal(e)}function J(e){z.visibleRangeList=e}const W=e(null);function X(e,l){z.publishTime=l}function $(e){W.value=e?y():null,z.publishTime=e?y().format(L):null}const B=e([]);function G(e){B.value=e,z.attachment=h.isEmpty(e)?[]:e}return U({showModal:function(e){Object.assign(z,S),W.value=null,B.value=[],async function(){try{const e=await F.getAllNoticeTypeList();D.value=e.data,D.value.length>0&&!z.noticeId&&(z.noticeTypeId=D.value[0].noticeTypeId)}catch(e){T.captureError(e)}}(),e&&async function(e){try{w.show();const l=await F.getUpdateNoticeInfo(e),a=l.data.attachment;h.isEmpty(a)?B.value=[]:B.value=a,Object.assign(z,l.data),z.allVisibleFlag=z.allVisibleFlag?1:0,W.value=y(l.data.publishTime),H.value=!0}catch(l){T.captureError(l)}finally{w.hide()}}(e),H.value=!0,b((()=>{M.value.clearValidate()}))}}),(e,l)=>{const b=a("a-input"),h=a("a-form-item"),y=a("a-select-option"),g=a("a-select"),T=a("a-button"),w=a("close-outlined"),F=a("a-tag"),C=a("a-switch"),U=a("a-date-picker"),N=a("a-form"),E=a("a-space"),S=a("a-drawer");return i(),t(u,null,[o(S,{title:z.noticeId?"编辑":"新建",open:H.value,width:1e3,footerStyle:{textAlign:"right"},onClose:R,destroyOnClose:!0},{footer:s((()=>[o(E,null,{default:s((()=>[o(T,{onClick:R},{default:s((()=>[c("取消")])),_:1}),o(T,{type:"primary",onClick:Y},{default:s((()=>[c("保存")])),_:1})])),_:1})])),default:s((()=>[o(N,{ref_key:"formRef",ref:M,model:z,rules:P,"label-col":{span:3},"wrapper-col":{span:20}},{default:s((()=>[o(h,{label:"公告标题",name:"title"},{default:s((()=>[o(b,{value:z.title,"onUpdate:value":l[0]||(l[0]=e=>z.title=e),placeholder:"请输入公告标题"},null,8,["value"])])),_:1}),o(h,{label:"分类",name:"noticeTypeId"},{default:s((()=>[o(g,{value:z.noticeTypeId,"onUpdate:value":l[1]||(l[1]=e=>z.noticeTypeId=e),style:{width:"100%"},showSearch:!0,allowClear:!0},{default:s((()=>[(i(!0),t(u,null,r(D.value,(e=>(i(),d(y,{key:e.noticeTypeId,value:e.noticeTypeId},{default:s((()=>[c(m(e.noticeTypeName),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),o(h,{label:"文号"},{default:s((()=>[o(b,{value:z.documentNumber,"onUpdate:value":l[2]||(l[2]=e=>z.documentNumber=e),placeholder:"文号，如：1024创新实验室发〔2022〕字第36号"},null,8,["value"])])),_:1}),o(h,{label:"作者",name:"author"},{default:s((()=>[o(b,{value:z.author,"onUpdate:value":l[3]||(l[3]=e=>z.author=e),placeholder:"请输入作者"},null,8,["value"])])),_:1}),o(h,{label:"来源",name:"source"},{default:s((()=>[o(b,{value:z.source,"onUpdate:value":l[4]||(l[4]=e=>z.source=e),placeholder:"请输入来源"},null,8,["value"])])),_:1}),o(h,{label:"可见范围",name:"allVisibleFlag"},{default:s((()=>[o(g,{value:z.allVisibleFlag,"onUpdate:value":l[5]||(l[5]=e=>z.allVisibleFlag=e),placeholder:"请选择可见范围"},{default:s((()=>[o(y,{value:1},{default:s((()=>[c("全部可见")])),_:1}),o(y,{value:0},{default:s((()=>[c("部分可见")])),_:1})])),_:1},8,["value"])])),_:1}),n(o(h,{label:"可见员工/部门"},{default:s((()=>[o(T,{type:"primary",onClick:A},{default:s((()=>[c("选择")])),_:1}),p("div",V,[(i(!0),t(u,null,r(z.visibleRangeList,((e,l)=>(i(),t("div",{class:"visible-item",key:e.dataId},[o(F,null,{default:s((()=>[p("span",null,m(e.dataName),1),o(w,{onClick:e=>function(e){x.confirm({title:"提示",content:"确定移除吗？",onOk(){z.visibleRangeList.splice(e,1)}})}(l)},null,8,["onClick"])])),_:2},1024)])))),128))])])),_:1},512),[[v,!z.allVisibleFlag]]),o(h,{label:"定时发布"},{default:s((()=>[o(C,{checked:z.scheduledPublishFlag,"onUpdate:checked":l[6]||(l[6]=e=>z.scheduledPublishFlag=e),"checked-children":"开","un-checked-children":"关",onChange:$},null,8,["checked"])])),_:1}),n(o(h,{label:"发布时间"},{default:s((()=>[o(U,{value:W.value,"onUpdate:value":l[7]||(l[7]=e=>W.value=e),format:L,showTime:"",allowClear:!1,placeholder:"请选择发布时间",style:{width:"200px"},onChange:X},null,8,["value"])])),_:1},512),[[v,z.scheduledPublishFlag]]),o(h,{label:"公告内容",name:"contentHtml"},{default:s((()=>[o(I,{ref_key:"contentRef",ref:q,modelValue:z.contentHtml,height:300},null,8,["modelValue"])])),_:1}),o(h,{label:"附件"},{default:s((()=>[o(j,{defaultFileList:B.value,maxUploadSize:10,folder:f(_).NOTICE.value,buttonText:"上传附件",listType:"text",extraMsg:"最多上传10个附件",onChange:G},null,8,["defaultFileList","folder"])])),_:1})])),_:1},8,["model"])])),_:1},8,["title","open"]),o(k,{ref_key:"noticeFormVisibleModal",ref:O,onSelectedFinish:J},null,512)],64)}}},[["__scopeId","data-v-0b9989d8"]]);export{U as default};
