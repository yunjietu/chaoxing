import{r as e}from"./regular-const-Uc_6Drqv.js";import{_ as a}from"./index-D6sqxCCk.js";import{_ as l}from"./index-BLMPELrm.js";import t from"./index-DPBcXeae.js";import{_ as r,y as s,F as o,e as i,z as n,s as d,k as m,S as u}from"./index-SeYMZHv7.js";import{b as p}from"./ant-design-vue-qdrtx42b.js";import{r as c,a as v,e as f,b2 as g,b as j,o as b,ai as y,c as h,bz as _,u as I,J as x,aP as w,ag as N,aY as k,aW as U}from"./@vue-wTDZSr7R.js";import"./lodash-DG05lPuJ.js";import"./@ant-design-BpN5YQ3K.js";import"./vue-LkNShnlx.js";import"./@ctrl-BZ4iwDfm.js";import"./department-api-IZzKtGZG.js";import"./position-api-Cwzz9KIn.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-Dk7pxPyP.js";import"./vue-i18n-DZLdcVEL.js";import"./@intlify-D9VlDxbJ.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-DUpU9tZe.js";import"./sm-crypto-CNoQwlJF.js";import"./jsbn-aJNYh3Pg.js";import"./nprogress-Buvl-64T.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-BUNCmyKw.js";import"./stylis-cmx5w8r8.js";import"./vue-types-Ci_fOQyt.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const M=e=>(k("data-v-51b87e2e"),e=e(),U(),e),E={class:"center-container"},z=M((()=>y("div",{class:"header-title"},"个人中心 ",-1))),F={class:"center-form-area"},q={class:"avatar-wrapper"},C={key:0,class:"avatar-container"},D=["src"],O=M((()=>y("div",{class:"overlay"},[y("span",null,"更新头像")],-1))),A={key:1},R=M((()=>y("div",{class:"ant-upload-text"},"上传头像",-1))),$=r({__name:"index",setup(r){const k=c();let U=v({...{employeeId:void 0,avatar:void 0,loginName:"",actualName:"",gender:void 0,phone:"",departmentId:void 0,email:void 0,positionId:void 0,disabledFlag:void 0,remark:""}});const M={actualName:[{required:!0,message:"姓名不能为空"},{max:30,message:"姓名不能大于30个字符",trigger:"blur"}],phone:[{required:!0,message:"手机号不能为空"},{pattern:e.phone,message:"请输入正确的手机号码",trigger:"blur"}],gender:[{required:!0,message:"性别不能为空"}],email:[{required:!0,message:"请输入邮箱"}]};let $=c();const B=c("--"),J=s().employeeId;async function L(){try{let e=(await n.getLoginInfo()).data;s().setUserLoginInfo(e),U.employeeId=e.employeeId,U.loginName=e.loginName,U.actualName=e.actualName,U.gender=e.gender,U.phone=e.phone,U.departmentId=e.departmentId,U.email=e.email,U.positionId=e.positionId,U.remark=e.remark,U.disabledFlag=e.disabledFlag,$.value=e.avatar}catch(e){d.captureError(e)}}J&&i.getBalance(J).then((e=>{B.value=e.data?.balance??"--"}));const S=c(".jpg,.jpeg,.png,.gif"),T=c(10),W=c(o.COMMON.value);let Y=c(!1);function G(e,a){const l=e.name.lastIndexOf("."),t=e.name.substring(l<=-1?0:l);if(-1===S.value.indexOf(t))return p.error(`只支持上传 ${S.value.replaceAll(","," ")} 格式的文件`),!1;return!!(e.size/1024/1024<T.value)||(p.error(`单个文件大小必须小于 ${T.value} Mb`),!1)}async function K(e){Y.value=!0;try{const a=new FormData;a.append("file",e.file);let l=(await m.uploadFile(a,W.value)).data;$.value=l.fileUrl;let t={avatar:l.fileKey};await i.updateAvatar(t),p.success("更新成功"),await L()}catch(a){d.captureError(a)}finally{Y.value=!1}}function P(){k.value.validate().then((()=>{!async function(){u.show();try{await i.updateCenter(U),p.success("更新成功"),await L()}catch(e){d.captureError(e)}finally{u.hide()}}()})).catch((e=>{p.error("参数验证错误，请仔细填写表单数据!")}))}return f((()=>{L()})),(e,r)=>{const o=g("a-input"),i=g("a-form-item"),n=g("a-textarea"),d=g("a-form"),m=g("a-button"),u=g("a-col"),p=g("loading-outlined"),c=g("plus-outlined"),v=g("a-upload"),f=g("a-row");return b(),j("div",E,[z,y("div",F,[h(f,{gutter:[16,16],class:"form-row"},{default:_((()=>[h(u,{xs:24,sm:24,md:16,lg:16,xl:16,class:"form-col"},{default:_((()=>[h(d,{ref_key:"formRef",ref:k,model:I(U),rules:M,layout:"vertical"},{default:_((()=>[h(i,{label:"登录账号",name:"loginName"},{default:_((()=>[h(o,{class:"form-item",value:I(U).loginName,"onUpdate:value":r[0]||(r[0]=e=>I(U).loginName=e),valueModifiers:{trim:!0},placeholder:"请输入登录账号",disabled:""},null,8,["value"])])),_:1}),h(i,{label:"余额",name:"balance"},{default:_((()=>[h(o,{class:"form-item",value:`￥${B.value}`,disabled:""},null,8,["value"])])),_:1}),h(i,{label:"部门",name:"departmentId"},{default:_((()=>[h(a,{class:"form-item",ref:"departmentTreeSelect",width:"100%",init:!1,value:I(U).departmentId,"onUpdate:value":r[1]||(r[1]=e=>I(U).departmentId=e),disabled:""},null,8,["value"])])),_:1}),h(i,{label:"员工名称",name:"actualName"},{default:_((()=>[h(o,{class:"form-item",value:I(U).actualName,"onUpdate:value":r[2]||(r[2]=e=>I(U).actualName=e),valueModifiers:{trim:!0},placeholder:"请输入员工名称"},null,8,["value"])])),_:1}),h(i,{label:"性别",name:"gender"},{default:_((()=>[h(t,{class:"form-item",value:I(U).gender,"onUpdate:value":r[3]||(r[3]=e=>I(U).gender=e),placeholder:"请选择性别","enum-name":"GENDER_ENUM"},null,8,["value"])])),_:1}),h(i,{label:"手机号码",name:"phone"},{default:_((()=>[h(o,{class:"form-item",value:I(U).phone,"onUpdate:value":r[4]||(r[4]=e=>I(U).phone=e),valueModifiers:{trim:!0},placeholder:"请输入手机号码"},null,8,["value"])])),_:1}),h(i,{label:"邮箱",name:"email"},{default:_((()=>[h(o,{value:I(U).email,"onUpdate:value":r[5]||(r[5]=e=>I(U).email=e),valueModifiers:{trim:!0},placeholder:"请输入邮箱"},null,8,["value"])])),_:1}),h(i,{label:"职务",name:"positionId"},{default:_((()=>[h(l,{value:I(U).positionId,"onUpdate:value":r[6]||(r[6]=e=>I(U).positionId=e),placeholder:"请选择职务"},null,8,["value"])])),_:1}),h(i,{label:"备注",name:"remark"},{default:_((()=>[h(n,{class:"form-item",value:I(U).remark,"onUpdate:value":r[7]||(r[7]=e=>I(U).remark=e),placeholder:"请输入备注",rows:4},null,8,["value"])])),_:1})])),_:1},8,["model"]),h(m,{type:"primary",onClick:P},{default:_((()=>[x("更新个人信息")])),_:1})])),_:1}),h(u,{xs:24,sm:24,md:8,lg:8,xl:8,class:"avatar-col"},{default:_((()=>[h(d,{layout:"vertical",class:w({"mobile-avatar":e.isMobileDevice})},{default:_((()=>[h(i,{label:"头像",name:"avatar"},{default:_((()=>[y("div",q,[h(v,{name:"avatar","list-type":"picture-card",class:"avatar-uploader","show-upload-list":!1,headers:{Authorization:"Bearer "+I(s)().getToken},customRequest:K,"before-upload":G},{default:_((()=>[I($)?(b(),j("div",C,[y("img",{src:I($),class:"avatar-image",alt:"avatar"},null,8,D),O])):(b(),j("div",A,[I(Y)?(b(),N(p,{key:0})):(b(),N(c,{key:1})),R]))])),_:1},8,["headers"])])])),_:1})])),_:1},8,["class"])])),_:1})])),_:1})])])}}},[["__scopeId","data-v-51b87e2e"]]);export{$ as default};
