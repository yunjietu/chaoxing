import{j as e}from"./job-api-BpqjCwip.js";import{T as a,S as l,s as t}from"./index-SeYMZHv7.js";import{b as o}from"./ant-design-vue-qdrtx42b.js";import{r,a as s,b2 as u,b as n,o as i,c as m,bz as p,u as d,J as c,ag as v,ah as b,ai as j}from"./@vue-wTDZSr7R.js";import"./@ant-design-BpN5YQ3K.js";import"./vue-LkNShnlx.js";import"./@ctrl-BZ4iwDfm.js";import"./lodash-DG05lPuJ.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-Dk7pxPyP.js";import"./vue-i18n-DZLdcVEL.js";import"./@intlify-D9VlDxbJ.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-DUpU9tZe.js";import"./sm-crypto-CNoQwlJF.js";import"./jsbn-aJNYh3Pg.js";import"./nprogress-Buvl-64T.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-BUNCmyKw.js";import"./stylis-cmx5w8r8.js";import"./vue-types-Ci_fOQyt.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const g=j("br",null,null,-1),f=j("br",null,null,-1),h={__name:"job-form-modal",emits:["reloadList"],setup(j,{expose:h,emit:y}){const x=y,w=r(!1),_=r(!1),C=r(),R={jobId:null,jobName:"",jobClass:"",triggerType:a.CRON.value,triggerValue:null,cron:"",fixedDelay:null,param:"",enabledFlag:!1,remark:"",sort:null};let N=s({...R});const k={jobName:[{required:!0,message:"请输入任务名称"}],jobClass:[{required:!0,message:"请输入执行类"}],triggerType:[{required:!0,message:"请选择触发类型"}],sort:[{required:!0,message:"请输入排序"}]};function D(){Object.assign(N,R),_.value=!1}async function T(){C.value.validate().then((async()=>{if(a.CRON.value===N.triggerType&&(N.triggerValue=N.cron),a.FIXED_DELAY.value===N.triggerType&&(N.triggerValue=N.fixedDelay),N.triggerValue)try{l.show(),w.value?(await e.addJob(N),o.success("添加成功")):(await e.updateJob(N),o.success("更新成功")),D(),x("reloadList")}catch(r){t.captureError(r)}finally{l.hide()}else o.error("请填写 触发时间")})).catch((e=>{o.error("参数验证错误，请检查表单数据")}))}const U=r(!1),E={jobId:null,jobName:"",jobClass:"",param:null};let O=s({...E});function F(){Object.assign(O,E),U.value=!1}async function z(){try{let a={jobId:O.jobId,param:O.param};await e.executeJob(a),l.show(),await new Promise((e=>setTimeout(e,2e3))),o.success("执行成功"),F(),x("reloadList")}catch(a){t.captureError(a)}finally{l.hide()}}return h({openUpdateModal:function(e){w.value=null==e,w.value||(Object.assign(N,e),a.CRON.value===e.triggerType&&(N.cron=e.triggerValue),a.FIXED_DELAY.value===e.triggerType&&(N.fixedDelay=e.triggerValue)),_.value=!0},openExecuteModal:function(e){Object.assign(O,e),U.value=!0}}),(e,l)=>{const t=u("a-input"),o=u("a-form-item"),r=u("a-textarea"),s=u("a-input-number"),j=u("a-radio-button"),h=u("a-radio-group"),y=u("a-switch"),x=u("a-form"),R=u("a-modal"),E=u("a-alert");return i(),n("div",null,[m(R,{open:_.value,width:650,title:w.value?"添加":"编辑","ok-text":"确认","cancel-text":"取消",onCancel:D,onOk:T},{default:p((()=>[m(x,{ref_key:"updateFormRef",ref:C,model:d(N),rules:k,"label-col":{span:4}},{default:p((()=>[m(o,{label:"任务名称",name:"jobName"},{default:p((()=>[m(t,{placeholder:"请输入任务名称",value:d(N).jobName,"onUpdate:value":l[0]||(l[0]=e=>d(N).jobName=e),maxlength:100,showCount:!0},null,8,["value"])])),_:1}),m(o,{label:"任务描述",name:"remark"},{default:p((()=>[m(r,{"auto-size":{minRows:2,maxRows:4},value:d(N).remark,"onUpdate:value":l[1]||(l[1]=e=>d(N).remark=e),placeholder:"(可选)请输入任务备注描述",maxlength:250,showCount:!0},null,8,["value"])])),_:1}),m(o,{label:"排序",name:"sort"},{default:p((()=>[m(s,{value:d(N).sort,"onUpdate:value":l[2]||(l[2]=e=>d(N).sort=e),min:-99999999,max:99999999,precision:0,style:{width:"100%"},placeholder:"值越小越靠前"},null,8,["value"])])),_:1}),m(o,{label:"执行类",name:"jobClass"},{default:p((()=>[m(r,{"auto-size":{minRows:2,maxRows:4},value:d(N).jobClass,"onUpdate:value":l[3]||(l[3]=e=>d(N).jobClass=e),placeholder:"示例：net.lab1024.sa.base.module.support.job.sample.SmartJobSample1",maxlength:200,showCount:!0},null,8,["value"])])),_:1}),m(o,{label:"任务参数",name:"param"},{default:p((()=>[m(r,{"auto-size":{minRows:3,maxRows:6},value:d(N).param,"onUpdate:value":l[4]||(l[4]=e=>d(N).param=e),placeholder:"(可选)请输入任务执行参数",maxlength:1e3,showCount:!0},null,8,["value"])])),_:1}),m(o,{label:"触发类型",name:"triggerType"},{default:p((()=>[m(h,{value:d(N).triggerType,"onUpdate:value":l[5]||(l[5]=e=>d(N).triggerType=e)},{default:p((()=>[m(j,{value:d(a).CRON.value},{default:p((()=>[c("CRON表达式")])),_:1},8,["value"]),m(j,{value:d(a).FIXED_DELAY.value},{default:p((()=>[c("固定间隔")])),_:1},8,["value"])])),_:1},8,["value"])])),_:1}),m(o,{label:"触发时间",name:"triggerTime"},{default:p((()=>[d(N).triggerType===d(a).CRON.value?(i(),v(t,{key:0,placeholder:"示例：10 15 0/1 * * *",value:d(N).cron,"onUpdate:value":l[6]||(l[6]=e=>d(N).cron=e),maxlength:100,showCount:!0},null,8,["value"])):d(N).triggerType===d(a).FIXED_DELAY.value?(i(),v(s,{key:1,value:d(N).fixedDelay,"onUpdate:value":l[7]||(l[7]=e=>d(N).fixedDelay=e),min:1,max:1e8,precision:0},{addonBefore:p((()=>[c("每隔")])),addonAfter:p((()=>[c("秒")])),_:1},8,["value"])):b("",!0)])),_:1}),m(o,{label:"是否开启",name:"enabledFlag"},{default:p((()=>[m(y,{checked:d(N).enabledFlag,"onUpdate:checked":l[8]||(l[8]=e=>d(N).enabledFlag=e)},null,8,["checked"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open","title"]),m(R,{open:U.value,width:650,title:"执行任务","ok-text":"执行","cancel-text":"取消",onCancel:F,onOk:z},{default:p((()=>[g,m(E,{type:"info","show-icon":"",style:{"margin-left":"25px"}},{message:p((()=>[c(" 点击【执行】后会按照【任务参数】，无论任务是否开启，都会立即执行。 ")])),_:1}),f,m(x,{"label-col":{span:4}},{default:p((()=>[m(o,{label:"任务名称",name:"jobName"},{default:p((()=>[m(t,{value:d(O).jobName,"onUpdate:value":l[9]||(l[9]=e=>d(O).jobName=e),disabled:!0},null,8,["value"])])),_:1}),m(o,{label:"任务类名",name:"jobClass"},{default:p((()=>[m(r,{"auto-size":{minRows:2,maxRows:4},value:d(O).jobClass,"onUpdate:value":l[10]||(l[10]=e=>d(O).jobClass=e),disabled:!0},null,8,["value"])])),_:1}),m(o,{label:"任务参数",name:"param"},{default:p((()=>[m(r,{"auto-size":{minRows:3,maxRows:6},value:d(O).param,"onUpdate:value":l[11]||(l[11]=e=>d(O).param=e),placeholder:"(可选)请输入任务执行参数",maxlength:1e3,showCount:!0},null,8,["value"])])),_:1})])),_:1})])),_:1},8,["open"])])}}};export{h as default};
