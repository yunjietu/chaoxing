import{d as e}from"./department-api-IZzKtGZG.js";import{_ as t}from"./lodash-DG05lPuJ.js";import{s as a,S as r}from"./index-SeYMZHv7.js";import l from"./department-form-modal-BTojEuYh.js";import{M as n}from"./ant-design-vue-qdrtx42b.js";import{E as o}from"./@ant-design-BpN5YQ3K.js";import{r as s,a as d,e as i,b2 as m,z as p,b as u,o as c,c as f,bz as y,y as v,ag as j,J as h,ah as I,F as k}from"./@vue-wTDZSr7R.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-Dk7pxPyP.js";import"./vue-i18n-DZLdcVEL.js";import"./@intlify-D9VlDxbJ.js";import"./vue-LkNShnlx.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-DUpU9tZe.js";import"./sm-crypto-CNoQwlJF.js";import"./jsbn-aJNYh3Pg.js";import"./nprogress-Buvl-64T.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./@ctrl-BZ4iwDfm.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-BUNCmyKw.js";import"./stylis-cmx5w8r8.js";import"./vue-types-Ci_fOQyt.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./index-D6sqxCCk.js";import"./index-BzPvxDWv.js";const w={key:0,class:"smart-table-operate"},x={__name:"department-list",setup(x){const g=s(""),b=s(!1),_=s(),C=s([]),E=s([]),q=s(new Map),z=d([]),N=s([{title:"部门名称",dataIndex:"departmentName",key:"departmentName"},{title:"负责人",dataIndex:"managerName",key:"managerName",width:100},{title:"排序",dataIndex:"sort",key:"sort",width:100},{title:"创建时间",dataIndex:"createTime",width:150},{title:"更新时间",dataIndex:"updateTime",width:150},{title:"操作",dataIndex:"action",fixed:"right",width:200}]);async function M(){try{b.value=!0;let a=(await e.queryAllDepartment()).data;a.forEach((e=>{q.value.set(e.departmentId,e)})),C.value=a,E.value=O(a,0),!t.isEmpty(E.value)&&E.value.length>0&&(_.value=E.value[0].departmentId),z.value=[],z.push(_.value)}catch(r){a.captureError(r)}finally{b.value=!1}}function O(e,a){let r=e.filter((e=>e.parentId===a))||[];return t.isEmpty(r)?null:(r.forEach((t=>{t.children=O(e,t.departmentId)})),r)}function R(){g.value="",T()}function T(){if(!g.value)return void(E.value=O(C.value,0));let e=C.value.concat();if(!e)return;let t=e.filter((e=>e.departmentName.indexOf(g.value)>-1)),a=[];t.forEach((e=>{K(a,e.departmentId)})),E.value=O(a,0)}function K(e,t,a){let r=q.value.get(t);r&&!e.some((e=>e.departmentId===t))&&(e.push(r),r.parentId&&0!==r.parentId&&K(e,r.parentId))}i((()=>{M()}));const D=s();function A(e){let t={departmentId:0,departmentName:"",parentId:e.departmentId||null};D.value.showModal(t)}return(t,s)=>{const d=m("a-input"),i=m("a-form-item"),x=m("SearchOutlined"),C=m("a-button"),q=m("ReloadOutlined"),O=m("a-button-group"),K=m("PlusOutlined"),F=m("a-row"),S=m("a-form"),J=m("a-table"),P=m("a-card"),U=p("privilege");return c(),u(k,null,[f(S,{class:"smart-query-form"},{default:y((()=>[f(F,{class:"smart-query-form-row"},{default:y((()=>[f(i,{label:"部门名称",class:"smart-query-form-item"},{default:y((()=>[f(d,{style:{width:"300px"},value:g.value,"onUpdate:value":s[0]||(s[0]=e=>g.value=e),placeholder:"请输入部门名称"},null,8,["value"])])),_:1}),f(i,{class:"smart-query-form-item smart-margin-left10"},{default:y((()=>[f(O,null,{default:y((()=>[v((c(),j(C,{type:"primary",onClick:T},{icon:y((()=>[f(x)])),default:y((()=>[h(" 查询 ")])),_:1})),[[U,"support:department:query"]]),v((c(),j(C,{onClick:R},{icon:y((()=>[f(q)])),default:y((()=>[h(" 重置 ")])),_:1})),[[U,"support:department:query"]])])),_:1}),v((c(),j(C,{type:"primary",onClick:A,class:"smart-margin-left20"},{icon:y((()=>[f(K)])),default:y((()=>[h(" 新建 ")])),_:1})),[[U,"system:department:add"]])])),_:1})])),_:1})])),_:1}),f(P,{size:"small",bordered:!0},{default:y((()=>[f(J,{size:"small",bordered:"",loading:b.value,rowKey:"departmentId",columns:N.value,"data-source":E.value,defaultExpandAllRows:!1,defaultExpandedRowKeys:z,pagination:!1},{bodyCell:y((({record:t,column:l})=>["action"===l.dataIndex?(c(),u("div",w,[v((c(),j(C,{onClick:e=>A(t),type:"link"},{default:y((()=>[h("添加下级")])),_:2},1032,["onClick"])),[[U,"system:department:add"]]),v((c(),j(C,{onClick:e=>{return a=t,void D.value.showModal(a);var a},type:"link"},{default:y((()=>[h("编辑")])),_:2},1032,["onClick"])),[[U,"system:department:update"]]),t.departmentId!==_.value?v((c(),j(C,{key:0,danger:"",onClick:l=>{return s=t.departmentId,void n.confirm({title:"提醒",icon:f(o),content:"确定要删除该部门吗?",okText:"删除",okType:"danger",async onOk(){r.show();try{await e.deleteDepartment(s),await M()}catch(t){a.captureError(t)}finally{r.hide()}},cancelText:"取消",onCancel(){}});var s},type:"link"},{default:y((()=>[h("删除")])),_:2},1032,["onClick"])),[[U,"system:department:delete"]]):I("",!0)])):I("",!0)])),_:1},8,["loading","columns","data-source","defaultExpandedRowKeys"]),f(l,{ref_key:"departmentFormModal",ref:D,onRefresh:M},null,512)])),_:1})],64)}}};export{x as default};
