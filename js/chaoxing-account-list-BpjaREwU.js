import{c as e,P as a,s as t,S as l}from"./index-SeYMZHv7.js";import{c as s}from"./chaoxing-account-api-D8TqxEcx.js";import o from"./chaoxing-account-operate-modal-CGO8vP49.js";import{d as i}from"./default-time-ranges-C0dlfVG_.js";import{_ as n}from"./index-C3kHkCVg.js";import r from"./clock-in-history-modal-BoIYB-iZ.js";import{M as c,b as d}from"./ant-design-vue-qdrtx42b.js";import{r as u,a as m,e as p,b2 as g,z as f,b as h,o as y,c as w,bz as k,u as j,K as v,J as _,ai as b,y as x,ag as I,ah as C,be as z,F as S}from"./@vue-wTDZSr7R.js";import"./@ant-design-BpN5YQ3K.js";import"./vue-LkNShnlx.js";import"./@ctrl-BZ4iwDfm.js";import"./lodash-DG05lPuJ.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-Dk7pxPyP.js";import"./vue-i18n-DZLdcVEL.js";import"./@intlify-D9VlDxbJ.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-DUpU9tZe.js";import"./sm-crypto-CNoQwlJF.js";import"./jsbn-aJNYh3Pg.js";import"./nprogress-Buvl-64T.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-BUNCmyKw.js";import"./stylis-cmx5w8r8.js";import"./vue-types-Ci_fOQyt.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./sortablejs-CRp0PNdb.js";/* empty css                                                                                 */const R={class:"smart-table-operate-block"},T={class:"smart-table-setting-block"},N={class:"smart-query-table-page"},O={__name:"chaoxing-account-list",setup(O){const P=u([{title:"ID",dataIndex:"id",align:"center",width:55},{title:"账号",dataIndex:"account",align:"center",width:100,ellipsis:!0},{title:"密码",dataIndex:"password",align:"center",width:100,ellipsis:!0},{title:"姓名",dataIndex:"name",align:"center",width:75,ellipsis:!0},{title:"学校ID",dataIndex:"schoolid",align:"center",width:80,ellipsis:!0,defaultHidden:!0},{title:"课程",dataIndex:"course",align:"center",width:80,ellipsis:!0},{title:"地址",dataIndex:"address",align:"center",width:160,ellipsis:!0},{title:"经度",dataIndex:"longitude",align:"center",width:90,ellipsis:!0},{title:"纬度",dataIndex:"latitude",align:"center",width:80,ellipsis:!0},{title:"状态",dataIndex:"disabledFlag",align:"center",width:60},{title:"打卡结果",dataIndex:"clockInResult",align:"center",width:80},{title:"创建时间",dataIndex:"createTime",width:120},{title:"操作",dataIndex:"action",width:200}]),q={keywords:"",endTime:null,startTime:null,pageNum:1,pageSize:e,searchCount:!0},E=m({...q}),U=u(!1),M=u([]),A=u(0);let D=u();function F(e,a){E.startTime=a[0],E.endTime=a[1]}function Q(){E.pageNum=1,H()}function V(){D.value=[],Object.assign(E,q),H()}async function H(){try{U.value=!0;let e=await s.pageQuery(E);const a=e.data.list;A.value=e.data.total,a.forEach((e=>{if(e._originalAccount=e.account,e._originalPassword=e.password,e._originalName=e.name,e.account&&11===e.account.length&&(e.account=e.account.substring(0,3)+"******"+e.account.substring(9)),e.password){const a=e.password.length;if(a<=6)e.password="******";else{const t=Math.floor((a-6)/2),l=a-6-t;e.password=e.password.substring(0,t)+"******"+(l>0?e.password.substring(a-l):"")}}e.name&&(3===e.name.length?e.name=e.name.substring(0,1)+"*"+e.name.substring(2):e.name.length>0&&(e.name=e.name.substring(0,1)+"*".repeat(e.name.length-1))),e.lastClockInResult?"SUCCESS"===e.lastClockInResult||"成功"===e.lastClockInResult?e.clockInResult="成功":"FAIL"===e.lastClockInResult||"失败"===e.lastClockInResult?e.clockInResult="失败":e.clockInResult=e.lastClockInResult:e.clockInResult="未打卡"})),M.value=a}catch(e){t.captureError(e)}finally{U.value=!1}}function J(e){c.confirm({title:"确定要删除吗？",content:"删除后，该信息将不可恢复",okText:"删除",okType:"danger",onOk(){!async function(e){try{l.show(),await s.delete(e),d.success("删除成功"),H()}catch(a){t.captureError(a)}finally{l.hide()}}(e)},cancelText:"取消",onCancel(){}})}const K=u();const $=u();return p(H),(e,c)=>{const u=g("a-input"),m=g("a-form-item"),p=g("a-col"),O=g("a-range-picker"),q=g("SearchOutlined"),L=g("a-button"),B=g("ReloadOutlined"),G=g("a-space"),W=g("a-row"),X=g("a-form"),Y=g("PlusOutlined"),Z=g("a-tag"),ee=g("a-table"),ae=g("a-pagination"),te=g("a-card"),le=f("privilege");return y(),h(S,null,[w(X,{class:"smart-query-form"},{default:k((()=>[w(W,{class:"smart-query-form-row",gutter:8},{default:k((()=>[w(p,{xs:24,sm:12,md:5},{default:k((()=>[w(m,{label:"关键字",class:"smart-query-form-item"},{default:k((()=>[w(u,{style:{width:"250px"},value:E.keywords,"onUpdate:value":c[0]||(c[0]=e=>E.keywords=e),placeholder:"姓名/账号/学校ID/课程/地址","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),w(p,{xs:24,sm:12,md:6},{default:k((()=>[w(m,{label:"创建时间",class:"smart-query-form-item"},{default:k((()=>[w(O,{value:j(D),"onUpdate:value":c[1]||(c[1]=e=>v(D)?D.value=e:D=e),presets:j(i),onChange:F,style:{width:"250px"}},null,8,["value","presets"])])),_:1})])),_:1}),w(p,{xs:24,sm:24,md:5},{default:k((()=>[w(m,{class:"smart-query-form-item"},{default:k((()=>[w(G,null,{default:k((()=>[w(L,{type:"primary",onClick:Q},{icon:k((()=>[w(q)])),default:k((()=>[_(" 查询 ")])),_:1}),w(L,{onClick:V},{icon:k((()=>[w(B)])),default:k((()=>[_(" 重置 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),w(te,{size:"small",bordered:!1,hoverable:!0},{default:k((()=>[w(W,{class:"smart-table-btn-block"},{default:k((()=>[b("div",R,[b("div",null,[x((y(),I(L,{onClick:c[2]||(c[2]=e=>{K.value.showModal()}),type:"primary"},{icon:k((()=>[w(Y)])),default:k((()=>[_(" 添加账号 ")])),_:1})),[[le,"oa:chaoxing-account:add"]])])]),b("div",T,[w(n,{modelValue:P.value,"onUpdate:modelValue":c[3]||(c[3]=e=>P.value=e),tableId:600,refresh:H},null,8,["modelValue"])])])),_:1}),w(ee,{scroll:{x:1500},size:"small",dataSource:M.value,columns:P.value,rowKey:"id",pagination:!1,loading:U.value,bordered:""},{bodyCell:k((({column:e,record:a,text:o})=>{return["disabledFlag"===e.dataIndex?(y(),I(Z,{key:0,color:o?"red":"green"},{default:k((()=>[_(z(o?"禁用":"启用"),1)])),_:2},1032,["color"])):C("",!0),"clockInResult"===e.dataIndex?(y(),I(Z,{key:1,color:(i=o,i?"成功"===i?"green":"失败"===i?"red":"":"")},{default:k((()=>[_(z(o),1)])),_:2},1032,["color"])):C("",!0),"action"===e.dataIndex?(y(),I(G,{key:2},{default:k((()=>[x((y(),I(L,{onClick:e=>{return t=a.id,void K.value.showModal(t);var t},size:"small",type:"link"},{default:k((()=>[_("编辑")])),_:2},1032,["onClick"])),[[le,"oa:chaoxing-account:update"]]),x((y(),I(L,{onClick:e=>J(a.id),size:"small",danger:"",type:"link"},{default:k((()=>[_("删除")])),_:2},1032,["onClick"])),[[le,"oa:chaoxing-account:delete"]]),x((y(),I(L,{onClick:e=>async function(e){const a={account:e._originalAccount||e.account,password:e._originalPassword||e.password,course:e.course,schoolid:e.schoolid,name:e._originalName||e.name,address:e.address,latitude:e.latitude,longitude:e.longitude};l.show();try{const e=await s.clockIn(a);e.ok?(d.success(e.data||"打卡成功"),setTimeout((()=>{H()}),500)):d.error(e.msg||"打卡失败")}catch(o){t.captureError(o)}finally{l.hide()}}(a),size:"small",type:"link"},{default:k((()=>[_("立即打卡")])),_:2},1032,["onClick"])),[[le,"oa:chaoxing-account:clockIn"]]),x((y(),I(L,{onClick:e=>async function(e){const a=e.course||"实习打卡";$.value.open({...e,course:a})}(a),size:"small",type:"link"},{default:k((()=>[_("打卡历史")])),_:2},1032,["onClick"])),[[le,"oa:chaoxing-account:detail"]])])),_:2},1024)):C("",!0)];var i})),_:1},8,["dataSource","columns","loading"]),b("div",N,[w(ae,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:j(a),defaultPageSize:E.pageSize,current:E.pageNum,"onUpdate:current":c[4]||(c[4]=e=>E.pageNum=e),pageSize:E.pageSize,"onUpdate:pageSize":c[5]||(c[5]=e=>E.pageSize=e),total:A.value,onChange:H,onShowSizeChange:H,"show-total":e=>`共${e}条`},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])]),w(o,{ref_key:"operateRef",ref:K,onRefresh:H},null,512)])),_:1}),w(r,{ref_key:"clockInHistoryModalRef",ref:$},null,512)],64)}}};export{O as default};
