import{c as e}from"./chaoxing-account-api-D8TqxEcx.js";import{s as a,S as t}from"./index-SeYMZHv7.js";import{b as l}from"./ant-design-vue-qdrtx42b.js";import{r as s,a as o,n as r,b2 as i,ag as n,o as d,bz as u,c,u as p,ai as m,b as g,be as h,J as v}from"./@vue-wTDZSr7R.js";import"./@ant-design-BpN5YQ3K.js";import"./vue-LkNShnlx.js";import"./@ctrl-BZ4iwDfm.js";import"./lodash-DG05lPuJ.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-Dk7pxPyP.js";import"./vue-i18n-DZLdcVEL.js";import"./@intlify-D9VlDxbJ.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-DUpU9tZe.js";import"./sm-crypto-CNoQwlJF.js";import"./jsbn-aJNYh3Pg.js";import"./nprogress-Buvl-64T.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-BUNCmyKw.js";import"./stylis-cmx5w8r8.js";import"./vue-types-Ci_fOQyt.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const f={style:{display:"flex","align-items":"center"}},y=["src","alt"],b={key:1,style:{width:"24px",height:"24px","margin-right":"8px","border-radius":"4px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex","align-items":"center","justify-content":"center",color:"white","font-size":"12px","font-weight":"bold"}},w={style:{display:"flex","align-items":"center"}},j=["src","alt"],x={key:1,style:{width:"16px",height:"16px","margin-right":"6px","border-radius":"2px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex","align-items":"center","justify-content":"center",color:"white","font-size":"8px","font-weight":"bold"}},_={__name:"chaoxing-account-operate-modal",emits:["refresh"],setup(_,{expose:k,emit:U}){k({showModal:function(l){Object.assign(z,$),P.value=[],R.value=!1,l?async function(l){try{let a=(await e.detail(l)).data;Object.assign(z,a),I.value=!a.disabledFlag,a.course&&(P.value=[{label:a.course,value:a.course,key:`default_${Date.now()}`}])}catch(s){a.captureError(s)}finally{t.hide()}}(l):I.value=!0;A.value=!0,r((()=>{const e=document.getElementsByClassName("ant-modal");e&&e.length>0&&Array.from(e).forEach((e=>{e.childNodes&&e.childNodes.length>0&&Array.from(e.childNodes).forEach((e=>{e.setAttribute&&e.setAttribute("aria-hidden","false")}))}))}))}});const C=U,A=s(!1);function D(){A.value=!1}const E=s(),$={id:void 0,account:void 0,password:void 0,name:void 0,schoolid:void 0,course:void 0,address:void 0,longitude:void 0,latitude:void 0,disabledFlag:!1};let z=o({...$});const q={account:[{required:!0,message:"请输入账号"}],password:[{required:!0,message:"请输入密码"}],course:[{required:!0,message:"请输入课程"}],address:[{required:!0,message:"请输入地址"}],longitude:[{required:!0,message:"请输入经度"}],latitude:[{required:!0,message:"请输入纬度"}]};function F(){E.value.validate().then((async()=>{t.show();try{z.id?await e.update(z):await e.create(z),l.success((z.id?"修改":"添加")+"成功"),D(),C("refresh")}catch(s){a.captureError(s)}finally{t.hide()}})).catch((e=>{}))}const I=s(!0);function N(e){z.disabledFlag=!e}const W=s(!1),O=s(!1),P=s([]),R=s(!1);function S(e){const a=e.target.value;z.address=a.replace(/\s+/g,"")}async function B(){if(z.address){W.value=!0;try{const a=z.address.replace(/\s+/g,""),t=await e.getLocationFromAddress({address:a});t.ok&&t.data?(z.longitude=t.data.longitude||"",z.latitude=t.data.latitude||"",l.success("获取经纬度成功")):l.error(t.msg||"获取经纬度失败")}catch(a){l.error("获取经纬度异常")}finally{W.value=!1}}else l.warning("请先输入地址")}function J(e){R.value=e}async function L(){if(z.account&&z.password){O.value=!0;try{const a=await e.getChaoxingUserInfo({account:z.account,password:z.password,schoolid:z.schoolid||""});if(!a.ok)return void l.error(a.msg||a.message||"获取信息失败");z.name=a.data.name||"",z.schoolid=a.data.schoolid||"";const t=await e.getChaoxingCourses({account:z.account,password:z.password,schoolid:z.schoolid||""});if(!t.ok||!t.data)return void l.error(t.msg||"获取课程失败");if(t.data.courseDetails&&Array.isArray(t.data.courseDetails))P.value=t.data.courseDetails.map(((e,a)=>{const t=e.proxyImageUrl||e.imageUrl;return{label:e.name,value:e.name,imageUrl:t,id:e.id,teacher:e.teacher,key:`${e.id}_${a}_${Date.now()}`}}));else{let e=[];t.data.courses?e=t.data.courses.split(",").map((e=>e.trim())):Array.isArray(t.data)?e=t.data:"string"==typeof t.data&&(e=t.data.split(",").map((e=>e.trim()))),P.value=e.map(((e,a)=>({label:e,value:e,key:`${e}_${a}_${Date.now()}`})))}P.value.length>0&&(z.course=P.value[0].value),l.success(`获取信息成功，共${P.value.length}门课程`),P.value.length>0&&(R.value=!0)}catch(a){const e=a?.response?.data?.msg||a?.response?.data?.message||a.message;e&&l.error(e)}finally{O.value=!1}}else l.warning("请先输入账号和密码")}function M(e){e.target.style.display="none"}return(e,a)=>{const t=i("a-input"),l=i("a-form-item"),s=i("a-input-password"),o=i("a-select"),r=i("a-button"),_=i("a-switch"),k=i("a-form"),U=i("a-modal");return d(),n(U,{open:A.value,title:p(z).id?"编辑":"添加",width:700,forceRender:"","ok-text":"确认","cancel-text":"取消",onOk:F,onCancel:D},{default:u((()=>[c(k,{ref_key:"formRef",ref:E,model:p(z),rules:q,"label-col":{span:5},"wrapper-col":{span:18}},{default:u((()=>[c(l,{label:"账号",name:"account"},{default:u((()=>[c(t,{value:p(z).account,"onUpdate:value":a[0]||(a[0]=e=>p(z).account=e),placeholder:"请输入账号",autocomplete:"username",style:{width:"70%","margin-right":"8px"}},null,8,["value"])])),_:1}),c(l,{label:"密码",name:"password"},{default:u((()=>[c(s,{value:p(z).password,"onUpdate:value":a[1]||(a[1]=e=>p(z).password=e),placeholder:"请输入密码",autocomplete:"current-password"},null,8,["value"])])),_:1}),c(l,{label:"姓名"},{default:u((()=>[c(t,{value:p(z).name,"onUpdate:value":a[2]||(a[2]=e=>p(z).name=e),placeholder:"请输入姓名"},null,8,["value"])])),_:1}),c(l,{label:"学校ID"},{default:u((()=>[c(t,{value:p(z).schoolid,"onUpdate:value":a[3]||(a[3]=e=>p(z).schoolid=e),placeholder:"请输入学校ID"},null,8,["value"])])),_:1}),c(l,{label:"课程",name:"course"},{default:u((()=>[c(o,{value:p(z).course,"onUpdate:value":a[4]||(a[4]=e=>p(z).course=e),placeholder:"请先获取课程列表",style:{width:"70%","margin-right":"8px"},disabled:0===P.value.length,options:P.value,"show-search":"","filter-option":"",open:R.value,onDropdownVisibleChange:J,getPopupContainer:e=>e.parentNode},{option:u((({label:e,value:a,imageUrl:t,id:l})=>[m("div",f,[t&&(t.startsWith("/oa/")||t.startsWith("http://localhost:1024/oa/"))?(d(),g("img",{key:0,src:t,alt:e,style:{width:"24px",height:"24px","margin-right":"8px","border-radius":"4px","object-fit":"cover"},onError:M},null,40,y)):(d(),g("div",b,h(e.charAt(0)),1)),m("span",null,h(e),1)])])),value:u((({value:e,label:a,imageUrl:t,id:l})=>[m("div",w,[t&&(t.startsWith("/oa/")||t.startsWith("http://localhost:1024/oa/"))?(d(),g("img",{key:0,src:t,alt:a,style:{width:"16px",height:"16px","margin-right":"6px","border-radius":"2px","object-fit":"cover"},onError:M},null,40,j)):(d(),g("div",x,h(a.charAt(0)),1)),m("span",null,h(a),1)])])),_:1},8,["value","disabled","options","open","getPopupContainer"]),c(r,{type:"primary",size:"small",onClick:L,loading:O.value},{default:u((()=>[v("一键获取信息")])),_:1},8,["loading"])])),_:1}),c(l,{label:"地址",name:"address"},{default:u((()=>[c(t,{value:p(z).address,"onUpdate:value":a[5]||(a[5]=e=>p(z).address=e),placeholder:"请输入地址",style:{width:"70%","margin-right":"8px"},onInput:S},null,8,["value"]),c(r,{type:"primary",size:"small",onClick:B,loading:W.value},{default:u((()=>[v("获取")])),_:1},8,["loading"])])),_:1}),c(l,{label:"经度",name:"longitude"},{default:u((()=>[c(t,{value:p(z).longitude,"onUpdate:value":a[6]||(a[6]=e=>p(z).longitude=e),placeholder:"请输入经度"},null,8,["value"])])),_:1}),c(l,{label:"纬度",name:"latitude"},{default:u((()=>[c(t,{value:p(z).latitude,"onUpdate:value":a[7]||(a[7]=e=>p(z).latitude=e),placeholder:"请输入纬度"},null,8,["value"])])),_:1}),c(l,{label:"启用状态",name:"disabledFlag"},{default:u((()=>[c(_,{checked:I.value,"onUpdate:checked":a[8]||(a[8]=e=>I.value=e),onChange:N},null,8,["checked"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open","title"])}}};export{_ as default};
