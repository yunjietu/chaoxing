import{u as a}from"./vue-router-BJIyZwNj.js";import{_ as e,K as s,S as l,h as t,z as o,J as i,H as c,y as r,q as n,u,O as d,s as p}from"./index-SeYMZHv7.js";import{l as m,w as v,a as g,d as f,q as h,b as j,f as y,g as w}from"./google-icon-BXU_orIT.js";import{b}from"./ant-design-vue-qdrtx42b.js";import{a as C,r as _,e as k,l as x,b2 as U,b as E,o as I,ai as N,u as q,c as D,bz as z,ag as L,ah as M,J as O,be as S,aY as B,aW as F}from"./@vue-wTDZSr7R.js";import"./@ant-design-BpN5YQ3K.js";import"./vue-LkNShnlx.js";import"./@ctrl-BZ4iwDfm.js";import"./lodash-DG05lPuJ.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-Dk7pxPyP.js";import"./vue-i18n-DZLdcVEL.js";import"./@intlify-D9VlDxbJ.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-DUpU9tZe.js";import"./sm-crypto-CNoQwlJF.js";import"./jsbn-aJNYh3Pg.js";import"./nprogress-Buvl-64T.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-BUNCmyKw.js";import"./stylis-cmx5w8r8.js";import"./vue-types-Ci_fOQyt.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const H=a=>(B("data-v-81cdd189"),a=a(),F(),a),J={class:"login-container"},K={class:"box-item desc"},R=H((()=>N("div",{class:"welcome"},[N("p",null,"欢迎登录自动化管理系统"),N("p",{class:"sub-welcome"},"高质量、简洁、高效、安全")],-1))),T=["src"],$={class:"box-item login"},A=["src"],P=H((()=>N("div",{class:"login-title"},"账号登录",-1))),W=["src"],Y={class:"more"},G=H((()=>N("div",{class:"title-box"},[N("p",{class:"line"}),N("p",{class:"title"},"其他方式登录"),N("p",{class:"line"})],-1))),Q={class:"login-type"},V=["src"],X=["src"],Z=["src"],aa=["src"],ea=["src"],sa=["src"],la=["src"],ta=e({__name:"login",setup(e){const B=C({loginName:"",password:"",captchaCode:"",captchaUuid:"",loginDevice:s.PC.value}),F={loginName:[{required:!0,message:"用户名不能为空"}],password:[{required:!0,message:"密码不能为空"}],captchaCode:[{required:!0,message:"验证码不能为空"}]},H=_(!1),ta=a(),oa=_(),ia=_(!1);async function ca(){oa.value.validate().then((async()=>{try{l.show();let a=Object.assign({},B,{password:t(B.password)});const e=await o.login(a);null!=ua&&(clearInterval(ua),ua=null),i(c.USER_TOKEN,e.data.token?e.data.token:""),b.success("登录成功"),r().setUserLoginInfo(e.data);const s=await n.getAllDictData();u().initData(s.data),d(),ta.push("/home")}catch(a){a.data&&0!==a.data.code&&(B.captchaCode="",na()),p.captureError(a)}finally{l.hide()}}))}k((()=>{document.onkeyup=a=>{13===a.keyCode&&ca()}})),x((()=>{document.onkeyup=null}));const ra=_("");async function na(){try{let e=await o.getCaptcha();ra.value=e.data.captchaBase64Image,B.captchaUuid=e.data.captchaUuid,a=e.data.expireSeconds,null===ua&&(ua=setInterval(na,1e3*(a-5)))}catch(e){}var a}let ua=null;k((()=>{na(),async function(){try{let a=await o.getTwoFactorLoginFlag();da.value=a.data}catch(a){p.captureError(a)}}()}));const da=_(!1);let pa=_("获取邮箱验证码"),ma=_(!1),va=null;async function ga(){try{l.show();await o.sendLoginEmailCode(B.loginName);b.success("验证码发送成功!请登录邮箱查看验证码~"),function(){ma.value=!0;let a=60;pa.value=`${a}秒后重新获取`,va=setInterval((()=>{a>1?(a--,pa.value=`${a}秒后重新获取`):(clearInterval(va),ma.value=!1,pa.value="获取验证码")}),1e3)}()}catch(a){p.captureError(a)}finally{l.hide()}}return(a,e)=>{const s=U("a-input"),l=U("a-form-item"),t=U("a-button"),o=U("a-input-group"),i=U("a-input-password"),c=U("a-checkbox"),r=U("a-form");return I(),E("div",J,[N("div",K,[R,N("img",{class:"welcome-img",src:q("/gif/login-min-C5MBv5eH.gif")},null,8,T)]),N("div",$,[N("img",{class:"login-qr",src:q(m)},null,8,A),P,D(r,{ref_key:"formRef",ref:oa,class:"login-form",model:B,rules:F},{default:z((()=>[D(l,{name:"loginName"},{default:z((()=>[D(s,{value:B.loginName,"onUpdate:value":e[0]||(e[0]=a=>B.loginName=a),valueModifiers:{trim:!0},placeholder:"请输入账号"},null,8,["value"])])),_:1}),da.value?(I(),L(l,{key:0,name:"emailCode"},{default:z((()=>[D(o,{compact:""},{default:z((()=>[D(s,{style:{width:"calc(100% - 110px)"},value:B.emailCode,"onUpdate:value":e[1]||(e[1]=a=>B.emailCode=a),autocomplete:"on",placeholder:"请输入邮箱验证码"},null,8,["value"]),D(t,{onClick:ga,class:"code-btn",type:"primary",disabled:q(ma)},{default:z((()=>[O(S(q(pa)),1)])),_:1},8,["disabled"])])),_:1})])),_:1})):M("",!0),D(l,{name:"password"},{default:z((()=>[D(i,{value:B.password,"onUpdate:value":e[2]||(e[2]=a=>B.password=a),autocomplete:"on",type:H.value?"text":"password",placeholder:"请输入密码：至少三种字符，最小 8 位"},null,8,["value","type"])])),_:1}),D(l,{name:"captchaCode"},{default:z((()=>[D(s,{class:"captcha-input",value:B.captchaCode,"onUpdate:value":e[3]||(e[3]=a=>B.captchaCode=a),valueModifiers:{trim:!0},placeholder:"请输入验证码"},null,8,["value"]),N("img",{class:"captcha-img",src:ra.value,onClick:na},null,8,W)])),_:1}),D(l,null,{default:z((()=>[D(c,{checked:ia.value,"onUpdate:checked":e[4]||(e[4]=a=>ia.value=a)},{default:z((()=>[O("记住密码")])),_:1},8,["checked"])])),_:1}),D(l,null,{default:z((()=>[N("div",{class:"btn",onClick:ca},"登录")])),_:1})])),_:1},8,["model"]),N("div",Y,[G,N("div",Q,[N("img",{src:q(v)},null,8,V),N("img",{src:q(g)},null,8,X),N("img",{src:q(f)},null,8,Z),N("img",{src:q(h)},null,8,aa),N("img",{src:q(j)},null,8,ea),N("img",{src:q(y)},null,8,sa),N("img",{src:q(w)},null,8,la)])])])])}}},[["__scopeId","data-v-81cdd189"]]);export{ta as default};
