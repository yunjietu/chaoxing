import{O as e,o as a}from"./operate-log-detail-modal-RxmPDu61.js";import{P as t,s}from"./index-SeYMZHv7.js";import{d as l}from"./default-time-ranges-C0dlfVG_.js";import{u as o}from"./ua-parser-js-D9VovvTw.js";import{_ as r}from"./index-C3kHkCVg.js";import{T as i}from"./table-id-const-CfofKxZg.js";import{r as d,a as u,e as n,b2 as p,z as m,b as c,o as v,y as g,c as f,ag as y,bz as j,u as h,J as b,ai as _,ah as w,be as x,F as I}from"./@vue-wTDZSr7R.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./ant-design-vue-qdrtx42b.js";import"./@babel-rSvM8Ko2.js";import"./@ant-design-BpN5YQ3K.js";import"./vue-LkNShnlx.js";import"./@ctrl-BZ4iwDfm.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-BUNCmyKw.js";import"./stylis-cmx5w8r8.js";import"./vue-types-Ci_fOQyt.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./dayjs-Dk7pxPyP.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./lodash-DG05lPuJ.js";import"./vue-i18n-DZLdcVEL.js";import"./@intlify-D9VlDxbJ.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-DUpU9tZe.js";import"./sm-crypto-CNoQwlJF.js";import"./jsbn-aJNYh3Pg.js";import"./nprogress-Buvl-64T.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./sortablejs-CRp0PNdb.js";/* empty css                                                                                 */const z={key:1},S={key:2},k={key:3,class:"smart-table-operate"},q={class:"smart-query-table-page"},U={__name:"operate-log-list",setup(U){const C=d([{title:"用户",dataIndex:"operateUserName",width:70},{title:"类型",dataIndex:"operateUserType",width:50,ellipsis:!0},{title:"操作模块",dataIndex:"module",ellipsis:!0},{title:"操作内容",dataIndex:"content",ellipsis:!0},{title:"请求路径",dataIndex:"url",ellipsis:!0},{title:"IP",dataIndex:"ip",ellipsis:!0},{title:"IP地区",dataIndex:"ipRegion",ellipsis:!0},{title:"客户端",dataIndex:"userAgent",ellipsis:!0},{title:"请求方法",dataIndex:"method",ellipsis:!0},{title:"请求结果",dataIndex:"successFlag",width:80},{title:"时间",dataIndex:"createTime",width:150},{title:"操作",dataIndex:"action",fixed:"right",width:60}]),N={userName:"",requestKeywords:"",keywords:"",successFlag:void 0,startDate:void 0,endDate:void 0,pageNum:1,pageSize:10},P=u({...N}),O=d([]),F=l;function D(e,a){P.startDate=a[0],P.endDate=a[1]}const E=d(!1),T=d([]),A=d(0);function L(){Object.assign(P,N),O.value=[],R()}function K(){P.pageNum=1,R()}async function R(){try{E.value=!0;let e=await a.queryList(P);for(const a of e.data.list){if(!a.userAgent)continue;let e=o(a.userAgent);a.browser=e.browser.name,a.os=e.os.name,a.device=e.device.vendor?e.device.vendor+e.device.model:""}const t=e.data.list;A.value=e.data.total,T.value=t}catch(e){s.captureError(e)}finally{E.value=!1}}n(R);const V=d();return(a,s)=>{const l=p("a-input"),o=p("a-form-item"),d=p("a-range-picker"),u=p("a-radio-button"),n=p("a-radio-group"),U=p("SearchOutlined"),N=p("a-button"),B=p("ReloadOutlined"),J=p("a-button-group"),M=p("a-row"),Q=p("a-form"),$=p("a-tag"),G=p("a-table"),X=p("a-pagination"),Y=p("a-card"),H=m("privilege");return v(),c(I,null,[g((v(),y(Q,{class:"smart-query-form"},{default:j((()=>[f(M,{class:"smart-query-form-row"},{default:j((()=>[f(o,{label:"操作关键字",class:"smart-query-form-item"},{default:j((()=>[f(l,{style:{width:"150px"},value:P.keywords,"onUpdate:value":s[0]||(s[0]=e=>P.keywords=e),placeholder:"模块/操作内容"},null,8,["value"])])),_:1}),f(o,{label:"请求关键字",class:"smart-query-form-item"},{default:j((()=>[f(l,{style:{width:"220px"},value:P.requestKeywords,"onUpdate:value":s[1]||(s[1]=e=>P.requestKeywords=e),placeholder:"请求地址/请求方法/请求参数"},null,8,["value"])])),_:1}),f(o,{label:"用户名称",class:"smart-query-form-item"},{default:j((()=>[f(l,{style:{width:"100px"},value:P.userName,"onUpdate:value":s[2]||(s[2]=e=>P.userName=e),placeholder:"用户名称"},null,8,["value"])])),_:1}),f(o,{label:"请求时间",class:"smart-query-form-item"},{default:j((()=>[f(d,{onChange:D,value:O.value,"onUpdate:value":s[3]||(s[3]=e=>O.value=e),presets:h(F),style:{width:"240px"}},null,8,["value","presets"])])),_:1}),f(o,{label:"快速筛选",class:"smart-query-form-item"},{default:j((()=>[f(n,{value:P.successFlag,"onUpdate:value":s[4]||(s[4]=e=>P.successFlag=e),onChange:K},{default:j((()=>[f(u,{value:void 0},{default:j((()=>[b("全部")])),_:1}),f(u,{value:!0},{default:j((()=>[b("成功")])),_:1}),f(u,{value:!1},{default:j((()=>[b("失败")])),_:1})])),_:1},8,["value"])])),_:1}),f(o,{class:"smart-query-form-item smart-margin-left10"},{default:j((()=>[f(J,null,{default:j((()=>[f(N,{type:"primary",onClick:R},{icon:j((()=>[f(U)])),default:j((()=>[b(" 查询 ")])),_:1}),f(N,{onClick:L},{icon:j((()=>[f(B)])),default:j((()=>[b(" 重置 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})),[[H,"support:operateLog:query"]]),f(Y,{size:"small",bordered:!1,hoverable:!0,style:{height:"100%"}},{default:j((()=>[f(M,{justify:"end"},{default:j((()=>[f(r,{class:"smart-margin-bottom5",modelValue:C.value,"onUpdate:modelValue":s[5]||(s[5]=e=>C.value=e),tableId:h(i).SUPPORT.CONFIG,refresh:R},null,8,["modelValue","tableId"])])),_:1}),f(G,{size:"small",loading:E.value,dataSource:T.value,columns:C.value,bordered:"",rowKey:"operateLogId",pagination:!1},{bodyCell:j((({text:e,record:t,column:s})=>["successFlag"===s.dataIndex?(v(),y($,{key:0,color:e?"success":"error"},{default:j((()=>[b(x(e?"成功":"失败"),1)])),_:2},1032,["color"])):w("",!0),"userAgent"===s.dataIndex?(v(),c("div",z,x(t.browser)+" / "+x(t.os)+" / "+x(t.device),1)):w("",!0),"operateUserType"===s.dataIndex?(v(),c("div",S,x(a.$smartEnumPlugin.getDescByValue("USER_TYPE_ENUM",e)),1)):"action"===s.dataIndex?(v(),c("div",k,[g((v(),y(N,{onClick:e=>{return a=t.operateLogId,void V.value.show(a);var a},type:"link"},{default:j((()=>[b("详情")])),_:2},1032,["onClick"])),[[H,"support:operateLog:detail"]])])):w("",!0)])),_:1},8,["loading","dataSource","columns"]),_("div",q,[f(X,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:h(t),defaultPageSize:P.pageSize,current:P.pageNum,"onUpdate:current":s[6]||(s[6]=e=>P.pageNum=e),pageSize:P.pageSize,"onUpdate:pageSize":s[7]||(s[7]=e=>P.pageSize=e),total:A.value,onChange:R,onShowSizeChange:R,"show-total":e=>`共${e}条`},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])]),f(e,{ref_key:"detailModal",ref:V},null,512)])),_:1})],64)}}};export{U as default};
