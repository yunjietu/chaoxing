import{_ as e}from"./lodash-DG05lPuJ.js";import{b as t,p as l,_ as a,S as n,s as o,i as s}from"./index-SeYMZHv7.js";import{r as u,n as r,b2 as c,ag as i,o as d,bz as m,b as p,u as f,c as h,J as y,be as g,ah as b,aP as v,F as w,y as x,E as k,ai as _,aY as C,aW as F,a as E,w as I,e as S}from"./@vue-wTDZSr7R.js";import{S as z}from"./sortablejs-CRp0PNdb.js";/* empty css                                                                                 */import{b as T,M as D}from"./ant-design-vue-qdrtx42b.js";const q=e=>l("/support/tableColumn/update",e),L=e=>t(`/support/tableColumn/getColumns/${e}`),O=e=>t(`/support/tableColumn/delete/${e}`);
/*
 *  表格列设置
 *
 * @Author:    1024创新实验室-主任：卓大
 * @Date:      2022-08-26 23:45:51
 * @Wechat:    zhuda1024
 * @Email:     lab1024@163.com
 * @Copyright  1024创新实验室 （ https://1024lab.net ），Since 2012
 */function j(t,l){let a=!1;if(!l)return t;let n=new Map;for(const e of l)n.set(e.columnKey,e);let o=1,s=[];for(const e of t){e.columnKey=e.dataIndex,e.defaultHidden?e.showFlag=!1:e.showFlag=!0,e.sort=o;let t=n.get(e.columnKey);t&&(e.sort=t.sort,e.showFlag=t.showFlag,e.dragAndDropFlag?(a=!0,delete e.dragAndDropFlag):t.width&&(e.width=t.width)),s.push(e),o++}return s=e.sortBy(s,(e=>e.sort)),{newColumns:s,saveFlag:a}}const K=e=>(C("data-v-60c42dd8"),e=e(),F(),e),V={key:0},M=K((()=>_("br",null,null,-1))),R=K((()=>_("br",null,null,-1))),A=K((()=>_("br",null,null,-1))),N=K((()=>_("br",null,null,-1))),B=K((()=>_("br",null,null,-1))),J=K((()=>_("br",null,null,-1))),U={key:1},X={key:0,class:"smart-table-operate"},$=a({__name:"smart-table-column-modal",emits:["change"],setup(t,{expose:l,emit:a}){const s=a;l({show:function(t,l){_=l,C.value=!0,async function(e,t){if(!e)return;n.show();let l=[];try{let t=await L(e);if(t.data)try{l=JSON.parse(t.data)}catch(s){o.captureError(s)}}catch(u){o.captureError(u)}finally{n.hide()}let a=j(t,l);I.value=a.newColumns,E.value=a.saveFlag;for(const n of I.value)n.showFlag&&$.value.push(n.columnKey);E.value&&W(!1);r((()=>{!function(){let e=document.querySelector("#smartTableColumnModalTable tbody");z.create(e,{animation:300,dragClass:"smart-ghost-class",ghostClass:"smart-ghost-class",chosenClass:"smart-ghost-class",handle:".handle",onEnd({newIndex:e,oldIndex:t}){e!==t&&K(t,e)}})}()}))}(_,e.cloneDeep(t))}});let _=null;const C=u(!1);function F(){C.value=!1}const E=u(!1);const I=u([]),S=[{title:"列",dataIndex:"title"},{title:"宽度(像素)",dataIndex:"width",width:150},{title:"操作",dataIndex:"operate",width:150,rowDrag:!0}];function K(e,t){const l=I.value.splice(e,1)[0];I.value.splice(t,0,l)}const $=u([]);function H(e){$.value=e}const P=u(!1);function Q(){D.confirm({title:"确定要恢复默认吗？",content:"确定恢复默认后，该信息将不可恢复",okText:"确定恢复",okType:"danger",onOk(){(async()=>{P.value=!0;try{await O(_),T.success("恢复默认成功"),s("change",[]),F()}catch(e){o.captureError(e)}finally{P.value=!1}})()},cancelText:"取消",onCancel(){}})}async function W(t=!0){P.value=!0;try{let l=[];for(let e=0;e<I.value.length;e++){let t=I.value[e],a={columnKey:t.columnKey,sort:e+1};t.width&&(a.width=t.width),a.showFlag=$.value.indexOf(t.columnKey)>-1,l.push(a)}l=e.sortBy(l,(e=>e.sort)),await q({tableId:_,columnList:l}),s("change",l),t&&(T.success("保存成功"),F())}catch(l){o.captureError(l)}finally{P.value=!1}}return(e,t)=>{const l=c("a-alert"),a=c("smile-outlined"),n=c("pushpin-outlined"),o=c("drag-outlined"),s=c("a-button"),u=c("a-input-number"),r=c("a-table"),E=c("a-modal");return d(),i(E,{width:800,open:C.value,title:"设置列",destroyOnClose:!0,closable:!1},{footer:m((()=>[h(s,{key:"back",onClick:F},{default:m((()=>[y("取消")])),_:1}),f(_)?(d(),i(s,{key:"submit",type:"primary",loading:P.value,onClick:W},{default:m((()=>[y("保存")])),_:1},8,["loading"])):b("",!0),f(_)?(d(),i(s,{key:"back",loading:P.value,onClick:Q,danger:"",style:{"margin-left":"20px"}},{default:m((()=>[y("恢复默认")])),_:1},8,["loading"])):b("",!0)])),default:m((()=>[f(_)?(d(),p("div",U,[h(l,{type:"info","show-icon":"",class:"smart-margin-bottom10"},{icon:m((()=>[h(a)])),message:m((()=>[y(" 可以通过拖拽行直接修改顺序哦；（ "),h(n),y("为固定列，不可拖拽 ）")])),_:1}),h(r,{id:"smartTableColumnModalTable",rowKey:"columnKey","row-class-name":"column-row",columns:S,dataSource:I.value,rowSelection:{checkStrictly:!1,selectedRowKeys:$.value,onChange:H},pagination:!1,size:"small",bordered:""},{bodyCell:m((({text:e,record:t,index:l,column:a})=>["title"===a.dataIndex?(d(),i(s,{key:0,type:"text",class:v(t.fixed?"":"handle"),size:"small",style:{width:"100%","text-align":"left"}},{icon:m((()=>[t.fixed?(d(),i(n,{key:1})):(d(),i(o,{key:0}))])),default:m((()=>[y(" "+g(e),1)])),_:2},1032,["class"])):b("",!0),"width"===a.dataIndex?(d(),p(w,{key:1},[h(u,{value:t.width,"onUpdate:value":e=>t.width=e,style:{width:"90px","margin-left":"10px","margin-right":"3px"},size:"small"},null,8,["value","onUpdate:value"]),y("px ")],64)):b("",!0),"operate"===a.dataIndex?(d(),p(w,{key:2},[t.fixed?b("",!0):(d(),p("div",X,[x(h(s,{onClick:e=>function(e){let t=e-1;t<0||I.value[t].fixed||K(e,t)}(l),type:"link",class:"handle",size:"small",style:{"margin-right":"12px"}},{default:m((()=>[y(" 上移 ")])),_:2},1032,["onClick"]),[[k,l>0]]),x(h(s,{onClick:e=>function(e){let t=e+1;t>=I.value.length||I.value[t].fixed||K(e,t)}(l),type:"link",class:"handle",size:"small"},{default:m((()=>[y(" 下移")])),_:2},1032,["onClick"]),[[k,l!==I.value.length-1]])]))],64)):b("",!0)])),_:1},8,["dataSource","rowSelection"])])):(d(),p("div",V,[h(l,{type:"error","show-icon":"",class:"smart-margin-bottom10"},{message:m((()=>[y(" 您尚未设置 TableOperator 组件的 tableId")])),_:1}),h(l,{type:"error",class:"smart-margin-bottom10"},{message:m((()=>[y(" 1. 请在 src\\constants\\support\\table-id-const.js 中配置 tableId 常量 "),M,R,y(" 2. 在自己的业务表格页面组件中使用如下： "),A,y(" 导入: import { TABLE_ID_CONST } from '/@/constants/support/table-id-const'; "),N,y(" 使用: "+g('<TableOperator v-model="columns" :tableId="TABLE_ID_CONST.BUSINESS.XXX" :refresh="queryData" />')+" "),B,J,y(" 3. 具体用法可参考员工管理 ")])),_:1})]))])),_:1},8,["open"])}}},[["__scopeId","data-v-60c42dd8"]]),H={__name:"index",props:{modelValue:{type:Array,default:[]},refresh:{type:Function,required:!0},tableId:{type:Number,require:!0}},emits:["update:modelValue"],setup(t,{emit:l}){const a=t,n=l;let r=E(e.cloneDeep(a.modelValue)),f=E(e.cloneDeep(a.modelValue));async function y(){if(!a.tableId)return;let e=[];try{let l=await L(a.tableId);if(l.data)try{e=JSON.parse(l.data)}catch(t){o.captureError(t)}}catch(l){o.captureError(l)}C(e)}I((()=>a.modelValue),(e=>{f.forEach((t=>{e.forEach((e=>{t.dataIndex==e.dataIndex&&Object.assign(t,e)}))}))}),{deep:!0}),S(y);const g=u(!1);function v(){g.value?(w(),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()):(g.value=!0,s().startFullScreen(),function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():T.error("当前浏览器不支持部分全屏！");document.addEventListener("fullscreenchange",x),document.addEventListener("mozfullscreenchange",x),document.addEventListener("webkitfullscreenchange",x),document.addEventListener("MSFullscreenChange",x)}(document.body))}function w(){g.value=!1,s().exitFullScreen(),document.removeEventListener("fullscreenchange",x),document.removeEventListener("mozfullscreenchange",x),document.removeEventListener("webkitfullscreenchange",x),document.removeEventListener("MSFullscreenChange",x)}function x(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement||w()}const k=u();function _(){k.value.show(f,a.tableId)}function C(t){let l={};l=e.isEmpty(t)?j(e.cloneDeep(r),t):j(e.cloneDeep(f),t);const a=l.newColumns;f.forEach((e=>{l.newColumns.forEach((t=>{e.dataIndex==t.dataIndex&&Object.assign(e,t)}))})),n("update:modelValue",a.filter((e=>e.showFlag)))}return I((()=>a.tableId),(t=>{t&&(r=e.cloneDeep(a.modelValue),f=e.cloneDeep(a.modelValue),y())}),{immediate:!0}),(e,t)=>{const l=c("fullscreen-outlined"),n=c("a-button"),o=c("a-tooltip"),s=c("fullscreen-exit-outlined"),u=c("redo-outlined"),r=c("setting-outlined");return d(),p("span",null,[g.value?b("",!0):(d(),i(o,{key:0,title:"全屏"},{default:m((()=>[h(n,{type:"text",onClick:v,size:"small"},{icon:m((()=>[h(l)])),_:1})])),_:1})),g.value?(d(),i(o,{key:1,title:"取消全屏"},{default:m((()=>[h(n,{type:"text",onClick:v,size:"small"},{icon:m((()=>[h(s)])),_:1})])),_:1})):b("",!0),h(o,{title:"刷新"},{default:m((()=>[h(n,{type:"text",onClick:a.refresh,size:"small"},{icon:m((()=>[h(u)])),_:1},8,["onClick"])])),_:1}),h(o,{title:"列设置"},{default:m((()=>[h(n,{type:"text",onClick:_,size:"small"},{icon:m((()=>[h(r)])),_:1})])),_:1}),h($,{ref_key:"smartTableColumnModal",ref:k,onChange:C},null,512)])}}};export{H as _};
