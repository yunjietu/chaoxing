import{j as e}from"./job-api-BpqjCwip.js";import{T as a,P as t,s as l}from"./index-SeYMZHv7.js";import o from"./job-log-list-modal-NDVWlrxH.js";import{T as i}from"./table-id-const-CfofKxZg.js";import{_ as s}from"./index-C3kHkCVg.js";import{r,a as d,e as n,b2 as u,z as p,b as m,o as c,c as g,ai as b,bz as y,F as j,b0 as f,ag as h,J as v,be as x,y as _,u as k,ah as w}from"./@vue-wTDZSr7R.js";import"./ant-design-vue-qdrtx42b.js";import"./@babel-rSvM8Ko2.js";import"./@ant-design-BpN5YQ3K.js";import"./vue-LkNShnlx.js";import"./@ctrl-BZ4iwDfm.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-BUNCmyKw.js";import"./stylis-cmx5w8r8.js";import"./vue-types-Ci_fOQyt.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./dayjs-Dk7pxPyP.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./lodash-DG05lPuJ.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./vue-i18n-DZLdcVEL.js";import"./@intlify-D9VlDxbJ.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-DUpU9tZe.js";import"./sm-crypto-CNoQwlJF.js";import"./jsbn-aJNYh3Pg.js";import"./nprogress-Buvl-64T.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./sortablejs-CRp0PNdb.js";/* empty css                                                                                 */const I={class:"smart-table-setting-block smart-margin-bottom10"},T={key:0},S=b("div",null,"下次执行(预估时间)",-1),z={key:5,class:"smart-table-operate"},C={class:"smart-query-table-page"},J={__name:"deleted-job-list",setup(J){const F=r([{title:"id",width:50,dataIndex:"jobId"},{title:"任务名称",dataIndex:"jobName",minWidth:150,ellipsis:!0},{title:"执行类",dataIndex:"jobClass",minWidth:180,ellipsis:!0},{title:"触发类型",dataIndex:"triggerType",width:110},{title:"触发配置",dataIndex:"triggerValue",width:150},{title:"上次执行",width:180,dataIndex:"lastJob"},{title:"下次执行",width:150,dataIndex:"nextJob"},{title:"启用状态",dataIndex:"enabledFlag",width:100},{title:"执行参数",dataIndex:"param",ellipsis:!0},{title:"任务描述",dataIndex:"remark",ellipsis:!0},{title:"排序",dataIndex:"sort",width:65},{title:"更新人",dataIndex:"updateName",width:90},{title:"更新时间",dataIndex:"updateTime",width:150},{title:"操作",dataIndex:"action",fixed:"right",width:70}]),O={searchWord:"",enabledFlag:null,triggerType:null,deletedFlag:!0,pageNum:1,pageSize:10},q=d({...O}),E=r(!1),L=r([]),N=r(0);function U(){Object.assign(q,O),P()}function D(){q.pageNum=1,P()}async function P(){try{E.value=!0;let a=await e.queryJob(q);const t=a.data.list;N.value=a.data.total,L.value=t}catch(a){l.captureError(a)}finally{E.value=!1}}n(P);const R=r();return(e,l)=>{const r=u("a-input"),d=u("a-form-item"),n=u("a-select-option"),J=u("a-select"),O=u("SearchOutlined"),W=u("a-button"),V=u("ReloadOutlined"),A=u("a-button-group"),G=u("a-row"),M=u("a-form"),Q=u("a-flex"),Y=u("a-tooltip"),$=u("a-tag"),B=u("CheckOutlined"),K=u("WarningOutlined"),X=u("a-switch"),H=u("a-table"),Z=u("a-pagination"),ee=p("privilege");return c(),m("div",null,[g(M,{class:"smart-query-form"},{default:y((()=>[g(G,{class:"smart-query-form-row"},{default:y((()=>[g(d,{label:"关键字",class:"smart-query-form-item"},{default:y((()=>[g(r,{style:{width:"200px"},value:q.searchWord,"onUpdate:value":l[0]||(l[0]=e=>q.searchWord=e),placeholder:"请输入关键字",maxlength:30},null,8,["value"])])),_:1}),g(d,{label:"触发类型",class:"smart-query-form-item"},{default:y((()=>[g(J,{style:{width:"155px"},value:q.triggerType,"onUpdate:value":l[1]||(l[1]=e=>q.triggerType=e),placeholder:"请选择触发类型",allowClear:""},{default:y((()=>[(c(!0),m(j,null,f(e.$smartEnumPlugin.getValueDescList("TRIGGER_TYPE_ENUM"),(e=>(c(),h(n,{key:e.value,value:e.value},{default:y((()=>[v(x(e.desc),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),g(d,{label:"状态",class:"smart-query-form-item"},{default:y((()=>[g(J,{style:{width:"150px"},value:q.enabledFlag,"onUpdate:value":l[2]||(l[2]=e=>q.enabledFlag=e),placeholder:"请选择状态",allowClear:""},{default:y((()=>[(c(),h(n,{key:1},{default:y((()=>[v(" 开启 ")])),_:1})),(c(),h(n,{key:0},{default:y((()=>[v(" 停止 ")])),_:1}))])),_:1},8,["value"])])),_:1}),g(d,{class:"smart-query-form-item smart-margin-left10"},{default:y((()=>[g(A,null,{default:y((()=>[_((c(),h(W,{type:"primary",onClick:D},{icon:y((()=>[g(O)])),default:y((()=>[v(" 查询 ")])),_:1})),[[ee,"support:job:query"]]),_((c(),h(W,{onClick:U},{icon:y((()=>[g(V)])),default:y((()=>[v(" 重置 ")])),_:1})),[[ee,"support:job:query"]])])),_:1})])),_:1})])),_:1})])),_:1}),g(Q,{align:"end",vertical:""},{default:y((()=>[b("div",I,[g(s,{class:"smart-margin-bottom5 pull-right",modelValue:F.value,"onUpdate:modelValue":l[3]||(l[3]=e=>F.value=e),tableId:k(i).SUPPORT.JOB,refresh:P},null,8,["modelValue","tableId"])])])),_:1}),g(H,{scroll:{x:1800},size:"small",loading:E.value,bordered:"",dataSource:L.value,columns:F.value,rowKey:"jobId",pagination:!1},{bodyCell:y((({record:e,column:t})=>["jobClass"===t.dataIndex?(c(),h(Y,{key:0},{title:y((()=>[v(x(e.jobClass),1)])),default:y((()=>{return[v(" "+x((a=e.jobClass,a.split(".").pop())),1)];var a})),_:2},1024)):w("",!0),"triggerType"===t.dataIndex?(c(),m(j,{key:1},[e.triggerType===k(a).CRON.value?(c(),h($,{key:0,color:"success"},{default:y((()=>[v(x(e.triggerTypeDesc),1)])),_:2},1024)):e.triggerType===k(a).FIXED_DELAY.value?(c(),h($,{key:1,color:"processing"},{default:y((()=>[v(x(e.triggerTypeDesc),1)])),_:2},1024)):(c(),h($,{key:2,color:"pink"},{default:y((()=>[v(x(e.triggerTypeDesc),1)])),_:2},1024))],64)):w("",!0),"lastJob"===t.dataIndex?(c(),m(j,{key:2},[e.lastJobLog?(c(),m("div",T,[g(Y,null,{title:y((()=>{return[v(x((a=e.lastJobLog.executeResult,a?a.substring(0,400)+(a.length>400?" ...":""):"")),1)];var a})),default:y((()=>[e.lastJobLog.successFlag?(c(),h(B,{key:0,style:{color:"#39c710"}})):(c(),h(K,{key:1,style:{color:"#f50"}})),v(" "+x(e.lastJobLog.executeStartTime),1)])),_:2},1024)])):w("",!0)],64)):w("",!0),"nextJob"===t.dataIndex?(c(),m(j,{key:3},[e.enabledFlag&&e.nextJobExecuteTimeList?(c(),h(Y,{key:0},{title:y((()=>[S,(c(!0),m(j,null,f(e.nextJobExecuteTimeList,(e=>(c(),m("div",{key:e},x(e),1)))),128))])),default:y((()=>[v(" "+x(e.nextJobExecuteTimeList[0]),1)])),_:2},1024)):w("",!0)],64)):w("",!0),"enabledFlag"===t.dataIndex?(c(),h(X,{key:4,"checked-children":"已启用","un-checked-children":"已禁用",checked:e.enabledFlag,"onUpdate:checked":a=>e.enabledFlag=a,disabled:"",loading:e.enabledLoading},null,8,["checked","onUpdate:checked","loading"])):w("",!0),"action"===t.dataIndex?(c(),m("div",z,[_((c(),h(W,{onClick:a=>{return t=e.jobId,l=e.jobName,void R.value.show(t,l);var t,l},type:"link"},{default:y((()=>[v("记录")])),_:2},1032,["onClick"])),[[ee,"support:job:log:query"]])])):w("",!0)])),_:1},8,["loading","dataSource","columns"]),b("div",C,[g(Z,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:k(t),defaultPageSize:q.pageSize,current:q.pageNum,"onUpdate:current":l[4]||(l[4]=e=>q.pageNum=e),pageSize:q.pageSize,"onUpdate:pageSize":l[5]||(l[5]=e=>q.pageSize=e),total:N.value,onChange:P,onShowSizeChange:P,"show-total":e=>`共${e}条`},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])]),g(o,{ref_key:"jobLogModal",ref:R},null,512)])}}};export{J as default};
