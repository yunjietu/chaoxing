import{e}from"./enterprise-api-CP888bMY.js";import{_ as s,S as l,s as a}from"./index-SeYMZHv7.js";import{a1 as t,an as r}from"./@ant-design-BpN5YQ3K.js";import{b as i}from"./ant-design-vue-qdrtx42b.js";import{r as o,b2 as u,ag as n,o as p,bz as c,ai as d,b as m,ah as v,c as f,J as j,u as y,be as h,F as g,b0 as b,aY as x,aW as w}from"./@vue-wTDZSr7R.js";import"./lodash-DG05lPuJ.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-Dk7pxPyP.js";import"./vue-i18n-DZLdcVEL.js";import"./@intlify-D9VlDxbJ.js";import"./vue-LkNShnlx.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-DUpU9tZe.js";import"./sm-crypto-CNoQwlJF.js";import"./jsbn-aJNYh3Pg.js";import"./nprogress-Buvl-64T.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./@ctrl-BZ4iwDfm.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-BUNCmyKw.js";import"./stylis-cmx5w8r8.js";import"./vue-types-Ci_fOQyt.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const _=e=>(x("data-v-cdcf1aa5"),e=e(),w(),e),k={class:"import-content"},C=_((()=>d("div",{class:"import-instructions"},[d("h4",null,"导入说明："),d("ul",null,[d("li",null,"请使用Excel文件格式(.xlsx或.xls)"),d("li",null,"第一行必须为表头，包含以下字段：企业名称、统一社会信用代码、企业类型、联系人、联系人电话、邮箱、省份名称、城市名称、区县名称、详细地址"),d("li",null,"企业类型支持：有限企业、外资企业"),d("li",null,"企业名称为必填项"),d("li",null,"企业名称不能重复")])],-1))),E={class:"template-download"},z={class:"file-upload"},I={key:0,class:"import-progress"},T=_((()=>d("p",null,"正在导入数据，请稍候...",-1))),D={key:1,class:"import-result"},F={key:0,class:"import-details"},M={key:0},B=_((()=>d("p",null,"错误详情：",-1))),J={class:"modal-footer"},S=s({__name:"enterprise-import-modal",emits:["refresh"],setup(s,{expose:x,emit:w}){x({showModal:function(){S.value=!0,W.value=[],A.value=null,q.value=0}});const _=w,S=o(!1),W=o([]),Y=o(!1),q=o(0),A=o(null);function G(){S.value=!1,W.value=[],A.value=null,q.value=0}function H(e){if(!("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type||"application/vnd.ms-excel"===e.type))return i.error("只能上传Excel文件！"),!1;return e.size/1024/1024<10?(W.value=[e],!1):(i.error("文件大小不能超过10MB！"),!1)}return(s,o)=>{const x=u("a-button"),w=u("a-upload"),K=u("a-progress"),L=u("a-alert"),N=u("a-modal");return p(),n(N,{open:S.value,title:"导入企业数据",width:600,footer:null,onCancel:G},{default:c((()=>[d("div",k,[C,d("div",E,[d("a",{onClick:o[0]||(o[0]=s=>function(){try{l.show(),e.downloadTemplate(),i.success("模板下载成功")}catch(s){a.captureError(s),i.error("模板下载失败")}finally{l.hide()}}()),class:"download-link"},[f(y(t)),j(" 下载导入模板 ")])]),d("div",z,[f(w,{"before-upload":H,"show-upload-list":!0,"file-list":W.value,accept:".xlsx,.xls",multiple:!1},{default:c((()=>[f(x,null,{icon:c((()=>[f(y(r))])),default:c((()=>[j(" 选择文件 ")])),_:1})])),_:1},8,["file-list"])]),Y.value?(p(),m("div",I,[f(K,{percent:q.value,status:"active"},null,8,["percent"]),T])):v("",!0),A.value?(p(),m("div",D,[f(L,{type:A.value.success?"success":"error",message:A.value.message,"show-icon":""},null,8,["type","message"]),A.value.details?(p(),m("div",F,[d("p",null,"成功导入："+h(A.value.details.successCount)+" 条",1),d("p",null,"失败："+h(A.value.details.failCount)+" 条",1),A.value.details.errors&&A.value.details.errors.length>0?(p(),m("div",M,[B,d("ul",null,[(p(!0),m(g,null,b(A.value.details.errors,((e,s)=>(p(),m("li",{key:s},h(e),1)))),128))])])):v("",!0)])):v("",!0)])):v("",!0)]),d("div",J,[f(x,{onClick:G},{default:c((()=>[j("取消")])),_:1}),f(x,{type:"primary",onClick:o[1]||(o[1]=s=>async function(){if(0===W.value.length)return void i.warning("请先选择要导入的文件");const s=new FormData;s.append("file",W.value[0]);try{Y.value=!0,q.value=0,A.value=null;const l=setInterval((()=>{q.value<90&&(q.value+=10)}),200),a=await e.importEnterprise(s);clearInterval(l),q.value=100,A.value={success:!0,message:"导入成功",details:a.data},i.success("企业数据导入成功"),_("refresh"),setTimeout((()=>{G()}),3e3)}catch(l){a.captureError(l),A.value={success:!1,message:l.message||"导入失败",details:l.data},i.error("企业数据导入失败")}finally{Y.value=!1}}()),loading:Y.value,disabled:0===W.value.length},{default:c((()=>[j(" 开始导入 ")])),_:1},8,["loading","disabled"])])])),_:1},8,["open"])}}},[["__scopeId","data-v-cdcf1aa5"]]);export{S as default};
