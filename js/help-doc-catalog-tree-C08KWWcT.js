import{_ as e}from"./lodash-DG05lPuJ.js";import a from"./help-doc-catalog-form-modal-Bv0YSJ13.js";import{_ as t,t as l,S as o,s}from"./index-SeYMZHv7.js";import{m as r}from"./mitt-CNZ6avp8.js";import{M as c}from"./ant-design-vue-qdrtx42b.js";import{E as n}from"./@ant-design-BpN5YQ3K.js";import{r as i,e as p,w as d,l as u,b2 as h,z as v,ag as m,o as f,bz as y,c as g,ah as C,b as k,ai as j,y as I,J as D,F as w,u as b,aR as x,be as _}from"./@vue-wTDZSr7R.js";import"./help-doc-catalog-tree-select-yC1AgDT7.js";import"./vue-LkNShnlx.js";import"./@ctrl-BZ4iwDfm.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-BUNCmyKw.js";import"./stylis-cmx5w8r8.js";import"./vue-types-Ci_fOQyt.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./dayjs-Dk7pxPyP.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./vue-i18n-DZLdcVEL.js";import"./@intlify-D9VlDxbJ.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-DUpU9tZe.js";import"./sm-crypto-CNoQwlJF.js";import"./jsbn-aJNYh3Pg.js";import"./nprogress-Buvl-64T.js";import"./vue-router-BJIyZwNj.js";
/*
 * 帮助文档 event bus
 *
 * @Author:    1024创新实验室-主任：卓大
 * @Date:      2022-09-12 18:06:41
 * @Wechat:    zhuda1024
 * @Email:     lab1024@163.com
 * @Copyright  1024创新实验室 （ https://1024lab.net ），Since 2012
 */const E=r(),M={style:{display:"flex","flex-direction":"column"}},K={key:0,class:"sort-span"},z={key:1},S={key:2,class:"no-data"},T=t({__name:"help-doc-catalog-tree",props:{checkable:{type:Boolean,default:!1},checkStrictly:{type:Boolean,default:!1},height:Number,showMenu:{type:Boolean,default:!0}},setup(t,{expose:r}){const T=t,B=i(),R=i([]),U=i([]),F=i(new Map),A=i(!1);async function H(){await L(),J.value&&$(J.value)}async function L(){let a=(await l.getAll()).data;R.value=a,U.value=N(a,0),a.forEach((e=>{F.value.set(e.helpDocCatalogId,e)})),!e.isEmpty(U.value)&&U.value.length>0&&(B.value=U.value[0].helpDocCatalogId,$(U.value[0].helpDocCatalogId))}function N(a,t){let l=a.filter((e=>e.parentId===t))||[];return l=e.sortBy(l,(e=>e.sort)),l.forEach((e=>{e.children=N(a,e.helpDocCatalogId)})),function(e){for(let a=0;a<e.length;a++)0!==a?a!==e.length-1?(e[a].preId=e[a-1].helpDocCatalogId,e[a].nextId=e[a+1].helpDocCatalogId):(e[a].preId=e[a-1].helpDocCatalogId,e[a].nextId=void 0):e[a].nextId=e.length>1?e[1].helpDocCatalogId:void 0}(l),l}p((()=>{L()}));const O=i([]),q=i([]),G=i([]),J=i(),Y=i([]);function $(e){O.value=[e],P(O.value)}function P(a){if(e.isEmpty(a))return G.value=[],void(Y.value=[]);let t=a[0];Y.value=R.value.filter((e=>e.parentId===t));let l=[];V(l,t,!0),G.value=l.map((e=>e.name))}E.on("selectTree",$);const Q=i("");function V(e,a,t){let l=F.value.get(a);l&&!e.some((e=>e.helpDocCatalogId===a))&&(t?e.unshift(l):e.push(l),l.parentId&&0!==l.parentId&&V(e,l.parentId,t))}d((()=>Q.value),(()=>{!function(){if(!Q.value)return void(U.value=N(R.value,0));let e=R.value.concat();if(!e)return;let a=e.filter((e=>e.name.indexOf(Q.value)>-1)),t=[];a.forEach((e=>{V(t,e.helpDocCatalogId,!1)})),U.value=N(t,0)}()}));const W=i();function X(){W.value.showModal({helpDocCatalogId:0,name:"",parentId:0})}return u((()=>{E.all.clear()})),r({queryHelpDocCatalogTree:L,selectedHelpDocCatalogChildren:Y,breadcrumb:G,selectedKeys:O,checkedKeys:q,keywords:Q}),(r,i)=>{const p=h("a-input"),d=h("a-row"),u=h("a-switch"),E=h("a-button"),F=h("a-popover"),N=h("a-tree"),G=h("a-card"),Y=v("privilege");return f(),m(G,{class:"tree-container",size:"small"},{default:y((()=>[g(d,null,{default:y((()=>[g(p,{value:Q.value,"onUpdate:value":i[0]||(i[0]=e=>Q.value=e),valueModifiers:{trim:!0},placeholder:"请输入目录名称"},null,8,["value"])])),_:1}),T.showMenu?(f(),m(d,{key:0,class:"sort-flag-row"},{default:y((()=>[j("span",null,[D(" 排序 "),A.value?(f(),k(w,{key:0},[D(" （越小越靠前） ")],64)):C("",!0),D(" ："),g(u,{checked:A.value,"onUpdate:checked":i[1]||(i[1]=e=>A.value=e)},null,8,["checked"])]),I((f(),m(E,{type:"primary",onClick:X,size:"small"},{default:y((()=>[D("新建")])),_:1})),[[Y,"support:helpDocCatalog:addCategory"]])])),_:1})):C("",!0),b(e).isEmpty(U.value)?(f(),k("div",S,"暂无结果")):(f(),m(N,{key:1,selectedKeys:O.value,"onUpdate:selectedKeys":i[2]||(i[2]=e=>O.value=e),checkedKeys:q.value,"onUpdate:checkedKeys":i[3]||(i[3]=e=>q.value=e),class:"tree",treeData:U.value,fieldNames:{title:"name",key:"helpDocCatalogId",value:"helpDocCatalogId"},style:x([{width:"100%","overflow-x":"auto"},[t.height?{height:`${t.height}px`,overflowY:"auto"}:""]]),showLine:!T.checkable,checkable:T.checkable,checkStrictly:T.checkStrictly,selectable:!T.checkable,defaultExpandAll:!0,onSelect:P},{title:y((a=>[T.showMenu?(f(),m(F,{key:0,placement:"right"},{content:y((()=>[j("div",M,[I((f(),m(E,{type:"text",onClick:e=>function(e){let a={helpDocCatalogId:0,name:"",parentId:e.helpDocCatalogId};J.value=e.helpDocCatalogId,W.value.showModal(a)}(a.dataRef)},{default:y((()=>[D("添加下级")])),_:2},1032,["onClick"])),[[Y,"support:helpDocCatalog:addCategory"]]),I((f(),m(E,{type:"text",onClick:e=>{return t=a.dataRef,J.value=t.helpDocCatalogId,void W.value.showModal(t);var t}},{default:y((()=>[D("修改")])),_:2},1032,["onClick"])),[[Y,"support:helpDocCatalog:edit"]]),a.helpDocCatalogId!==B.value?I((f(),m(E,{key:0,type:"text",onClick:t=>{return r=a.helpDocCatalogId,void c.confirm({title:"提醒",icon:g(n),content:"确定要删除该目录吗?",okText:"删除",okType:"danger",async onOk(){o.show();try{let a=null;if(!e.isEmpty(O.value)&&(a=O.value[0],a===r)){let e=R.value.find((e=>e.helpDocCatalogId===r));e&&e.parentId&&(a=e.parentId)}await l.delete(r),await L(),a&&$(a)}catch(a){s.captureError(a)}finally{o.hide()}},cancelText:"取消",onCancel(){}});var r}},{default:y((()=>[D("删除")])),_:2},1032,["onClick"])),[[Y,"support:helpDocCatalog:delete"]]):C("",!0)])])),default:y((()=>[D(" "+_(a.name)+" ",1),A.value?(f(),k("span",K,"("+_(a.sort)+")",1)):C("",!0)])),_:2},1024)):(f(),k("div",z,_(a.name),1))])),_:1},8,["selectedKeys","checkedKeys","treeData","style","showLine","checkable","checkStrictly","selectable"])),g(a,{ref_key:"helpDocCatalogFormModal",ref:W,onRefresh:H},null,512)])),_:1})}}},[["__scopeId","data-v-69801ffa"]]);export{T as default};
