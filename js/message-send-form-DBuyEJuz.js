import{w as e,S as s,x as t,s as a}from"./index-SeYMZHv7.js";import r from"./index-DPBcXeae.js";import l from"./message-receiver-modal-3tWFNBV1.js";import{b as o}from"./ant-design-vue-qdrtx42b.js";import{r as i,a as n,b2 as m,b as u,o as p,c as d,bz as c,u as v,ai as f,J as j,be as y,F as g,n as b}from"./@vue-wTDZSr7R.js";import"./@ant-design-BpN5YQ3K.js";import"./vue-LkNShnlx.js";import"./@ctrl-BZ4iwDfm.js";import"./lodash-DG05lPuJ.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-Dk7pxPyP.js";import"./vue-i18n-DZLdcVEL.js";import"./@intlify-D9VlDxbJ.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-DUpU9tZe.js";import"./sm-crypto-CNoQwlJF.js";import"./jsbn-aJNYh3Pg.js";import"./nprogress-Buvl-64T.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-BUNCmyKw.js";import"./stylis-cmx5w8r8.js";import"./vue-types-Ci_fOQyt.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const h={__name:"message-send-form",emits:["reloadList"],setup(h,{expose:_,emit:U}){const w=U,E=i(!1);function L(){Object.assign(M,I),E.value=!1}const T=i(),I={title:void 0,receiverUserIdList:null,content:null,messageType:null,receiverUserType:e.ADMIN_EMPLOYEE.value};let M=n({...I});const x={title:[{required:!0,message:"标题 必填"}],content:[{required:!0,message:"推送内容 必填"}],receiverUserIdList:[{required:!0,message:"推送人 必填"}],messageType:[{required:!0,message:"消息类型 必填"}]},C=i();function k(e,s){M.receiverUserIdList=e,C.value=s.join(",")}const O=i();function q(){O.value.showModal(M.receiverUserIdList)}async function z(){try{await T.value.validateFields(),async function(){s.show();try{let s=[];for(const t of M.receiverUserIdList)s.push({title:M.title,receiverUserId:t,content:M.content,messageType:M.messageType,receiverUserType:e.ADMIN_EMPLOYEE.value});await t.sendMessages(s),o.success("操作成功"),w("reloadList"),L()}catch(r){a.captureError(r)}finally{s.hide()}}()}catch(r){o.error("参数验证错误，请仔细填写表单数据!")}}return _({show:function(e){Object.assign(M,I),C.value=null,E.value=!0,b((()=>{T.value.clearValidate()}))}}),(e,s)=>{const t=m("a-input"),a=m("a-form-item"),o=m("a-button"),i=m("a-textarea"),n=m("a-form"),b=m("a-space"),h=m("a-modal");return p(),u(g,null,[d(h,{title:"添加",width:700,open:E.value,onCancel:L,maskClosable:!1,destroyOnClose:!0},{footer:c((()=>[d(b,null,{default:c((()=>[d(o,{onClick:L},{default:c((()=>[j("取消")])),_:1}),d(o,{type:"primary",onClick:z},{default:c((()=>[j("保存")])),_:1})])),_:1})])),default:c((()=>[d(n,{ref_key:"formRef",ref:T,model:v(M),rules:x,"label-col":{span:5},"wrapper-col":{span:16}},{default:c((()=>[d(a,{label:"标题",name:"title"},{default:c((()=>[d(t,{style:{width:"100%"},value:v(M).title,"onUpdate:value":s[0]||(s[0]=e=>v(M).title=e),placeholder:"标题"},null,8,["value"])])),_:1}),d(a,{label:"接收人",name:"receiverUserIdList"},{default:c((()=>[d(o,{onClick:q,type:"primary"},{default:c((()=>[j(" 选择接收人 ")])),_:1}),f("div",null,y(C.value),1)])),_:1}),d(a,{label:"消息类型",name:"messageType"},{default:c((()=>[d(r,{width:"100%",value:v(M).messageType,"onUpdate:value":s[1]||(s[1]=e=>v(M).messageType=e),placeholder:"请选择类型","enum-name":"MESSAGE_TYPE_ENUM"},null,8,["value"])])),_:1}),d(a,{label:"推送内容",name:"content"},{default:c((()=>[d(i,{style:{width:"100%"},value:v(M).content,"onUpdate:value":s[2]||(s[2]=e=>v(M).content=e),placeholder:"推送内容"},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open"]),d(l,{ref_key:"receiverModalRef",ref:O,onReloadList:k},null,512)],64)}}};export{h as default};
