import{_ as e}from"./lodash-DG05lPuJ.js";import{M as t,_ as a,U as l,F as o,S as r,v as s,s as i}from"./index-SeYMZHv7.js";import{W as n}from"./index-CtS3x09i.js";import u from"./help-doc-catalog-tree-select-yC1AgDT7.js";import{m as d}from"./menu-api-DyF2x50w.js";import{b as m}from"./menu-data-handler-J-32ogBg.js";import{r as p,e as c,b2 as v,ag as f,o as h,u as y,a as j,bz as g,c as b,ah as _,J as I,n as w}from"./@vue-wTDZSr7R.js";import{b as L}from"./ant-design-vue-qdrtx42b.js";import"./@ant-design-BpN5YQ3K.js";import"./vue-LkNShnlx.js";import"./@ctrl-BZ4iwDfm.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-Dk7pxPyP.js";import"./vue-i18n-DZLdcVEL.js";import"./@intlify-D9VlDxbJ.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-DUpU9tZe.js";import"./sm-crypto-CNoQwlJF.js";import"./jsbn-aJNYh3Pg.js";import"./nprogress-Buvl-64T.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-BUNCmyKw.js";import"./stylis-cmx5w8r8.js";import"./vue-types-Ci_fOQyt.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./@wangeditor-next-BWE1cd2r.js";const x={__name:"index",props:{value:Array,multiple:{type:Boolean,default:!1}},emits:["update:value"],setup(a,{expose:l,emit:o}){const r=a,s=o;let i=p([]);c(u);let n=[];async function u(){let e=await d.queryMenu();n=e.data.filter((e=>e.menuType===t.MENU.value||e.menuType===t.CATALOG.value));for(const a of n)a.menuType===t.CATALOG.value&&(a.disabled=!0);i.value=m(n)}function j(e){s("update:value",e)}return l({queryMenuTree:u,getMenuListByIdList:function(t){return e.cloneDeep(n.filter((e=>t.indexOf(e.menuId)>-1)))}}),(e,t)=>{const a=v("a-tree-select");return h(),f(a,{value:r.value,treeData:y(i),fieldNames:{label:"menuName",key:"menuId",value:"menuId"},"show-search":"","tree-checkable":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"请选择菜单","allow-clear":"","tree-default-expand-all":"",onChange:j},null,8,["value","treeData"])}}},C=a({__name:"help-doc-form-drawer",emits:["reloadList"],setup(t,{expose:a,emit:d}){const m=d,c=p(!1);function C(){c.value=!1}const D=p(),T=p(),U=p(!1),k={helpDocId:void 0,helpDocCatalogId:void 0,title:void 0,author:void 0,sort:0,attachment:[],relationIdList:[],contentHtml:"",contentText:""},H=j({...k}),M={title:[{required:!0,message:"请输入"}],helpDocCatalogId:[{required:!0,message:"请选择目录"}],author:[{required:!0,message:"请输入作者"}],sort:[{required:!0,message:"请输入排序"}],contentHtml:[{required:!0,message:"请输入内容"}]};async function O(){try{H.contentHtml=T.value.getHtml(),H.contentText=T.value.getText(),await D.value.validateFields(),await async function(){try{r.show();let t=e.cloneDeep(H);if(U.value)t.relationList=[{relationName:"首页",relationId:0}];else{let e=q.value.getMenuListByIdList(H.relationIdList);t.relationList=e.map((e=>Object.assign({},{relationId:e.menuId,relationName:e.menuName})))}t.helpDocId?await s.update(t):await s.add(t),L.success("保存成功"),m("reloadList"),C()}catch(t){i.captureError(t)}finally{r.hide()}}()}catch(t){L.error("参数验证错误，请仔细填写表单数据!")}}const q=p();const E=p([]);function A(t){E.value=t,H.attachment=e.isEmpty(t)?[]:t}return a({showModal:function(t){Object.assign(H,k),E.value=[],t&&async function(t){try{r.show();const a=await s.getDetail(t),l=a.data.attachment;e.isEmpty(l)?E.value=[]:E.value=l,Object.assign(H,a.data),H.relationIdList=a.data.relationList?a.data.relationList.map((e=>e.relationId)):[],1===H.relationIdList.length&&0===H.relationIdList[0].relationId?U.value=!0:U.value=!1}catch(a){i.captureError(a)}finally{r.hide()}}(t),c.value=!0,w((()=>{D.value.clearValidate()}))}}),(e,t)=>{const a=v("a-input"),r=v("a-form-item"),s=v("a-input-number"),i=v("a-radio-button"),d=v("a-radio-group"),m=v("a-form"),p=v("a-button"),j=v("a-space"),w=v("a-drawer");return h(),f(w,{title:H.helpDocId?"编辑系统手册":"新建系统手册",open:c.value,width:1e3,footerStyle:{textAlign:"right"},onClose:C,destroyOnClose:!0},{footer:g((()=>[b(j,null,{default:g((()=>[b(p,{onClick:C},{default:g((()=>[I("取消")])),_:1}),b(p,{type:"primary",onClick:O},{default:g((()=>[I("保存")])),_:1})])),_:1})])),default:g((()=>[b(m,{ref_key:"formRef",ref:D,model:H,rules:M,"label-col":{span:3},"wrapper-col":{span:20}},{default:g((()=>[b(r,{label:"标题",name:"title"},{default:g((()=>[b(a,{value:H.title,"onUpdate:value":t[0]||(t[0]=e=>H.title=e),placeholder:"请输入标题"},null,8,["value"])])),_:1}),b(r,{label:"目录",name:"helpDocCatalogId"},{default:g((()=>[b(u,{value:H.helpDocCatalogId,"onUpdate:value":t[1]||(t[1]=e=>H.helpDocCatalogId=e),style:{width:"100%"}},null,8,["value"])])),_:1}),b(r,{label:"作者",name:"author"},{default:g((()=>[b(a,{value:H.author,"onUpdate:value":t[2]||(t[2]=e=>H.author=e),placeholder:"请输入作者"},null,8,["value"])])),_:1}),b(r,{label:"排序",name:"sort"},{default:g((()=>[b(s,{value:H.sort,"onUpdate:value":t[3]||(t[3]=e=>H.sort=e),placeholder:"值越小越靠前"},null,8,["value"]),I("（值越小越靠前） ")])),_:1}),b(r,{label:"是否首页显示"},{default:g((()=>[b(d,{value:U.value,"onUpdate:value":t[4]||(t[4]=e=>U.value=e),"button-style":"solid"},{default:g((()=>[b(i,{value:!0},{default:g((()=>[I("首页显示")])),_:1}),b(i,{value:!1},{default:g((()=>[I("首页不用显示")])),_:1})])),_:1},8,["value"])])),_:1}),U.value?_("",!0):(h(),f(r,{key:0,label:"关联菜单"},{default:g((()=>[b(x,{value:H.relationIdList,"onUpdate:value":t[5]||(t[5]=e=>H.relationIdList=e),ref_key:"menuTreeSelect",ref:q},null,8,["value"])])),_:1})),b(r,{label:"公告内容",name:"contentHtml"},{default:g((()=>[b(n,{ref_key:"contentRef",ref:T,modelValue:H.contentHtml,height:300},null,8,["modelValue"])])),_:1}),b(r,{label:"附件"},{default:g((()=>[b(l,{defaultFileList:E.value,maxUploadSize:10,folder:y(o).HELP_DOC.value,buttonText:"上传附件",listType:"text",extraMsg:"最多上传10个附件",onChange:A},null,8,["defaultFileList","folder"])])),_:1})])),_:1},8,["model"])])),_:1},8,["title","open"])}}},[["__scopeId","data-v-9a8e2adb"]]);export{C as default};
